####################################################
# using functions to split operation while ensuring loop fusion
####################################################