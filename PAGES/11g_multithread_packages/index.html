<!-- 
#################################################
# HEAD - FOR ALL PAGES
#################################################
 --><!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Martin Alfaro"><script>function applySavedTheme(){"enabled"===localStorage.getItem("darkMode")&&document.documentElement.classList.add("dark-mode")}applySavedTheme()</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Cormorant+SC:wght@300;400;600;700&family=Inter:wght@300..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet"><link rel="stylesheet" href="/julia_book/libs/katex/katex.min.css"><link rel="stylesheet" href="/julia_book/libs/highlight/styles/vs_myversion.css"><link rel="stylesheet" href="/julia_book/css/bootstrap.min.css"><style>.section-bg-color{background-color:rgba(63,99,136,.07)}footer a{color:#6495ed}header{margin-top:0!important}header .jumbotron{background-image:linear-gradient(to right,#000,#000 10%,#3f6388 55%,#3f6388);background-repeat:no-repeat;background-size:100%}</style><link rel="stylesheet" href="/julia_book/css/custom.css"><title>11g. Multithreading Packages - Julia Book - Martin Alfaro</title><link rel="icon" type="image/png" href="/julia_book/assets/icons/favicon.ico"></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-K96JNP7PKB"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-K96JNP7PKB")</script><body id="page-top"><!-- 
#################################################
# FOR EACH SPECIFIC PAGE
#################################################
 --><style>html{scroll-behavior:auto}.bar_top,.jumbotron,.left_bar,.nav-item,.navbar,footer{font-size:16px;font-family:"Open Sans"}.franklin-content{font-size:17px;font-family:"Open Sans"}h1{font-family:Inter,"Open Sans";font-weight:600}h1{padding-top:.1em;font-size:210%!important;font-weight:700;text-align:center}.phd_format{color:#fff;text-decoration:none;font-size:90%;text-align:center;margin-top:-.2em;margin-bottom:-.89em}.name_format{padding-top:.35em;text-decoration:none;font-size:160%}.name_format a{color:#fff}.name_format a:hover{color:#d4d4d4;color:#d6e3f0}.franklin-content{background-color:#d9e0e7}.franklin-content{margin:0;width:100%;height:100%;justify-content:center;text-align:justify;text-justify:inter-word;line-height:1.65}.jumbotron{margin-bottom:0;padding-top:42px;padding-bottom:2em;border-bottom:#000 solid 1px;border-radius:0}.franklin-content,.jumbotron{padding-left:160px}footer{background-image:linear-gradient(to right,#23374b,#000 50%,#3f6388);background-color:#3f6388;width:calc(100%+10px);margin-left:-10px;padding-left:10px}h2{text-transform:uppercase;font-size:160%;text-align:center;text-decoration:underline;padding-bottom:.5em;font-weight:700}h3{text-align:left;text-transform:uppercase;text-decoration:underline;padding-bottom:0;padding-top:.5em;font-size:120%;font-weight:600}h4 a{font-weight:800!important}h4{text-align:left;color:#3a6c9e;text-decoration:underline;padding-bottom:0;padding-top:.5em;font-weight:800!important;text-transform:uppercase;font-size:120%}h5,h6{text-indent:0;line-height:1.2em;padding-top:.99em;padding-bottom:-0em}section{margin-left:0;padding-left:1%;padding-right:1%;padding-top:1.5%;padding-bottom:1%;text-align:justify;text-justify:inter-word;line-height:1.65;text-indent:0;font-size:100%;color:#000}section h1{text-indent:0;margin-left:0}section h2{text-indent:0;margin-bottom:0}.franklin-content ul{margin-left:0;margin-top:-.6em;line-height:1.15}.franklin-content ul li p{margin-left:0;margin-bottom:.6em;line-height:1.35;text-indent:0}.franklin-content ol li{margin-left:2em;line-height:1.15}ul ::marker{color:#49739d}ol ::marker{color:#5381af;font-weight:700}a.anchor{display:block;position:relative;top:-150px;visibility:hidden}section a{color:#3e79b4;text-decoration:underline;font-weight:500}section a:hover{color:rgba(62,121,180,.699);text-decoration:underline}</style><style>:target{scroll-margin-top:40px}.own-anchors a{scroll-margin-top:4em}</style><div class="left_bar" style="color:#fff"><span><img src="/julia_book/assets/pics_html/julia_logo-dark.svg" alt="pic" style="padding:12px;padding-right:28px;padding-top:44px" width="160px" height="auto"></span><ul><li style="text-transform:uppercase"><a href="/julia_book/index.html"><img src="/julia_book/assets/icons/home.png" style="width:15%;height:auto;opacity:.9;padding-bottom:5px"> Home</a></li><li style="text-transform:uppercase"><a href="/julia_book/list_posts/"><img src="/julia_book/assets/icons/books03.png" style="width:15%;height:auto;opacity:.9;padding-bottom:5px"> Chapters</a></li><li><div style="text-indent:0"><button class="modalButton" style="text-transform:uppercase"><img src="/julia_book/assets/icons/keyboard01.png" style="width:20%;height:auto;opacity:.9;margin-bottom:-26px;margin-left:-30px;padding-right:4px"> <span style="margin-left:-.2em">Notation &<div style="margin-left:-1.2em;margin-top:-3em">Hotkeys</div></span></button><div class="kbd_shortcuts"><div class="modal" id="kbdmodal_bar"><div class="modal-content"><div class="modal-header"><h2>NOTATION</h2></div><div class="modal-body" style="height:auto">Generic expressions are represented by <b>&lt;something&gt;</b> (e.g., <code>&lt;function&gt;</code> or <code>&lt;operator&gt;</code>). This is just notation, and the symbols <code>&lt;</code> and <code>&gt;</code> should not be misconstrued as Julia's syntax.</div><div class="modal-header"><h2>PAGE LAYOUT</h2></div><div class="modal-body">If you want to adjust the size of the font, <b>zoom in or out on pages</b> by respectively using <kbd>Ctrl</kbd>+<kbd>+</kbd> and <kbd>Ctrl</kbd>+<kbd>-</kbd>. The layout will adjust automatically.<br><span class="brmine"></span></div><div class="modal-header"><h2>LINKS TO SECTIONS</h2></div><div class="modal-body">To quickly share a link to a specific section, simply hover over the title and click on it. The link will be automatically copied to your clipboard, ready to be pasted. <span class="brmine"></span></div><div class="modal-header"><h2>KEYBOARD SHORTCUTS</h2></div><div class="modal-body"><style type="text/css">.tg{border-collapse:collapse;border-spacing:0}.tg td{border-color:#000;border-style:solid;border-width:1px;overflow:hidden;padding:10px 12px;word-break:normal}.tg th{border-color:#000;border-style:solid;border-width:1px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-80zn{background-color:rgba(63,99,136,.2);border-color:#fff;font-weight:700;text-align:center;vertical-align:top}.tg .tg-esg4{background-color:#ebebeb;border-color:#fff;font-weight:700;text-align:right;vertical-align:top}.tg .tg-8jgo{border-color:#fff;text-align:left;vertical-align:top}.tg .tg-ofj5{border-color:#fff;text-align:center;vertical-align:top}</style><table class="tg" style="margin-left:auto;margin-right:auto"><thead><tr><th class="tg-80zn">Action</th><th class="tg-80zn">Keyboard Shortcut</th></tr></thead><tbody><tr><td class="tg-8jgo">Previous Section</td><td class="tg-ofj5"><kbd>Ctrl + ðŸ ˜</kbd></td></tr><tr><td class="tg-8jgo">Next Section</td><td class="tg-ofj5"><kbd>Ctrl + ðŸ š</kbd></td></tr><tr><td class="tg-8jgo">List of Sections</td><td class="tg-ofj5"><kbd>Ctrl + z</kbd></td></tr><tr><td class="tg-8jgo">List of Subsections</td><td class="tg-ofj5"><kbd>Ctrl + x</kbd></td></tr><tr><td class="tg-8jgo">Close Any Popped Up Window (like this one)</td><td class="tg-ofj5"><kbd>Esc</kbd></td></tr><tr><td class="tg-8jgo">Open All Codes and Outputs in a Post</td><td class="tg-ofj5"><kbd>Alt + ðŸ ›</kbd></td></tr><tr><td class="tg-8jgo">Close All Codes and Outputs in a Post</td><td class="tg-ofj5"><kbd>Alt + ðŸ ™</kbd></td></tr></tbody></table><span class="brmine"></span></div><div class="modal-header"><h2>TIME MEASUREMENT</h2></div><div class="modal-body">When benchmarking, the equivalence of time measures is as follows.<br><br><style type="text/css">.tg{border-collapse:collapse;border-spacing:0}.tg td{border-color:#000;border-style:solid;border-width:1px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{border-color:#000;border-style:solid;border-width:1px;font-weight:400;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-80zn{background-color:#ebebeb;border-color:#fff;font-weight:700;text-align:left;vertical-align:top}.tg .tg-esg4{background-color:#ebebeb;border-color:#fff;font-weight:700;text-align:right;vertical-align:top}.tg .tg-8jgo{border-color:#fff;text-align:left;vertical-align:top}.tg .tg-ofj5{border-color:#fff;text-align:center;vertical-align:top}</style><table class="tg" style="margin-left:auto;margin-right:auto"><thead><tr><th class="tg-80zn">Unit</th><th class="tg-80zn">Acronym</th><th class="tg-80zn">Measure in Seconds</th></tr></thead><tbody><tr><td class="tg-8jgo">Seconds</td><td class="tg-ofj5">s</td><td class="tg-ofj5">1</td></tr><tr><td class="tg-8jgo">Milliseconds</td><td class="tg-ofj5">ms</td><td class="tg-ofj5">10<sup>-3</sup></td></tr><tr><td class="tg-8jgo">Microseconds</td><td class="tg-ofj5">Î¼s</td><td class="tg-ofj5">10<sup>-6</sup></td></tr><tr><td class="tg-8jgo">Nanoseconds</td><td class="tg-ofj5">ns</td><td class="tg-ofj5">10<sup>-9</sup></td></tr></tbody></table></div></div><style>.left_bar .kbd_shortcuts{color:#000;font-size:16px;line-height:1.55;list-style-type:none;position:relative}.left_bar .kbd_shortcuts kbd{font-size:14px}.left_bar .kbd_shortcuts .modal-content{position:relative;width:1200px;max-width:90%;height:max-content;max-height:90%;margin-top:55px;background-color:#cfdae4;overflow:auto}.left_bar .kbd_shortcuts .modal-body{margin:0;padding-bottom:12px;text-align:justify;padding-top:8px;padding-bottom:2px;overflow:visible;height:100%}.left_bar .kbd_shortcuts .modal-header{padding:0;color:#fff;width:100%}.left_bar .kbd_shortcuts .modal-header h2{padding-top:8px;font-size:20px;font-weight:700;width:100%;text-align:center;color:#fff;background-color:#3f6388}.left_bar .modalButton{border:none;box-shadow:none;width:auto;padding:0;background-color:transparent;color:#fff;margin:0}.left_bar .brmine{display:block;margin-bottom:.5em}</style></div></div></div></li><li style="text-transform:uppercase"><a href="/julia_book/links/"><img src="/julia_book/assets/icons/links.png" style="width:15%;height:auto;opacity:.9;padding-bottom:5px"> Links</a></li><li><a href="/julia_book/assets/pdf/juliaBook_Alfaro.pdf"><img src="/julia_book/assets/icons/icon_pdf.png" style="width:15%;height:auto;opacity:.9;padding-bottom:5px"> BOOK in PDF</a></li><li><h3 style="font-weight:400;font-size:14px;padding-top:4em;margin-bottom:-.6em;text-decoration:none">Dark Mode</h3><label class="switch"><input type="checkbox" id="toggleStyles"> <span class="slider round"></span></label></li></ul><div class="searchForm"><form action="https://duckduckgo.com/" method="get" onsubmit="return prependSiteOperator()"><input type="text" id="searchInput" name="q" placeholder="Search..." required></form></div><div class="personal_website"><a href="https://alfaromartino.github.io"><img src="/julia_book/assets/icons/personal.png" style="width:18%;height:auto;opacity:.9;margin-bottom:-14px;padding-right:4px"> Personal<div style="margin-left:calc(30px + 2px);margin-top:-.5em">Website</div></a></div></div><style>@media (max-width:850px),(max-height:600px){.left_bar{display:none}}.left_bar{z-index:200;background-image:linear-gradient(to left bottom,#000,#000 10%,#3f6388 80%,#3f6388);position:fixed;font-family:Inter,"Open Sans";height:100%;top:0;left:0;font-size:20px;width:160px}.left_bar ul{list-style-type:none;float:left;font-size:80%;position:relative;padding-left:.8em;padding-top:40px;line-height:4.25em}.left_bar .personal_website a,.left_bar li a{color:#fff}.left_bar .personal_website a:hover,.left_bar a:hover{color:#a09f9f}.left_bar .personal_website{position:absolute;bottom:0;padding-bottom:1em;left:12px;font-size:20px;font-family:"Cormorant SC";font-weight:700}</style><script>function prependSiteOperator(){var e=document.getElementById("searchInput");return e.value="site:https://alfaromartino.github.io/julia_book/ "+e.value,!0}</script><style>.left_bar .searchForm{width:100%}.left_bar .searchForm input[type=text]{width:100%;box-sizing:border-box;background-color:inherit;border:0 solid;border-color:#fff;height:60px;color:#fff;padding-left:.6em;font-size:85%}</style><style>.switch{position:relative;display:inline-block;width:30px;height:17px}.switch input{display:none}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s}.slider:before{position:absolute;content:"";height:13px;width:13px;left:2px;bottom:2px;background-color:#fff;transition:.4s}input:checked+.slider{background-color:#000}input:checked+.slider:before{transform:translateX(13px)}.slider.round{border-radius:17px}.slider.round:before{border-radius:50%}html.dark-mode{background-color:#030911!important}html.dark-mode .franklin-content,html.dark-mode .modal-body{background-color:#030911!important}html.dark-mode .franklin-content section,html.dark-mode .index_container,html.dark-mode .modal-content{color:#ebf4fc!important}html.dark-mode .index_container,html.dark-mode .index_container h1{background-color:#030d18!important}html.dark-mode .index_container ul>li{color:#ebf4fc!important}html.dark-mode .index_container a{color:#588cc0}html.dark-mode .index_container a:hover,html.dark-mode h2:hover,html.dark-mode section a:hover{color:#bed5ec}html.dark-mode .multiple_pics{background-color:#4b6d92}html.dark-mode .multiple_pics h2{color:#fff!important}html.dark-mode .note,html.dark-mode .warning{color:#000}html.dark-mode .code_box,html.dark-mode .code_in_modal,html.dark-mode .img_output_in_modal,html.dark-mode .output_in_modal{border-width:1px;border-style:solid;border-color:rgba(0,44,82,.99)}html.dark-mode .tab_wrapper .tab_code_links .tablink.active{background-color:rgba(94,140,185,.95)}html.dark-mode .tab_wrapper .tab_code_links .tablink:hover{background-color:rgba(94,140,185,.95)}html.dark-mode .bar_top,html.dark-mode .nav-menu.show,html.dark-mode nav .nav-toggle{background-image:linear-gradient(to top,#122030,#122030 60%)!important}html.dark-mode .bar_top .modal-body,html.dark-mode .bar_top .modal-content,html.dark-mode .bar_top .modal-header{background-image:linear-gradient(to top,#122030,#122030 60%)!important}html.dark-mode header .jumbotron{background-image:linear-gradient(to bottom,#122030,#122030 50%)!important}html.dark-mode .left_bar{background-image:linear-gradient(to left bottom,#122030,#122030 10%)}html.dark-mode footer{background-image:linear-gradient(to right,#122030,#000 10%)!important;border-top:1px solid rgba(0,44,82,.99);background-color:rgba(63,99,136,.3);width:calc(100%+10px);margin-left:0;padding-left:10px}html.dark-mode .left_bar .kbd_shortcuts .modal-content{background-color:#000!important}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("toggleStyles"),t=document.documentElement;"enabled"===localStorage.getItem("darkMode")&&(e.checked=!0),e.addEventListener("change",function(){this.checked?(t.classList.add("dark-mode"),localStorage.setItem("darkMode","enabled")):(t.classList.remove("dark-mode"),localStorage.setItem("darkMode","disabled"))})})</script><header class="text-white text-center"><div class="jumbotron jumbotron-fluid container-fluid bg-primary"><h1><i>11g.</i> Multithreading Packages</h1><div class="lead"></div><div class="name_format"><a href="https://alfaromartino.github.io/" target="_blank" rel="noopener noreferrer">Martin Alfaro</a></div><div class="phd_format">PhD in Economics</div></div></header><link href="https://fonts.cdnfonts.com/css/cascadia-mono" rel="stylesheet"><style>pre{position:relative;overflow:hidden}code{background-color:#d1d9e0;color:#000;text-indent:0;padding-top:.1em;padding-bottom:.1em;padding-left:.3em;padding-right:.3em;vertical-align:.05em;border:1px solid #001029;overflow:hidden}.julia_repl_NoFormat code,.mixed_output_NoFormat code{background-color:#527868;color:#dcdcdc;border:1px solid #527868}.copy-button{cursor:pointer;border:none;font-size:12px;text-transform:lowercase;font-weight:500;padding:2px 10px 2px;background-color:#3f6388;position:absolute;top:0;right:12px;text-align:center;color:#fff;margin-top:0;z-index:1}.copy-button:hover{outline:0;background-color:#5483b3}.copy-button:focus{outline:0;background-color:#324e6b}.julia_line{color:#20c679!important;font-weight:700;display:inline;font-size:100%}.julia_repl_NoFormat{font-size:87%}.julia_repl_NoFormat .julia_line,.julia_repl_NoFormat code{font-size:100%}.mixed_output_NoFormat{font-size:87%}.mixed_output_NoFormat .julia_line,.mixed_output_NoFormat code,.mixed_output_NoFormat pre{font-size:100%}.akin_to_pre{white-space:pre-wrap;font-family:Consolas,monospace}.julia_repl_NoFormat{font-family:Consolas,monospace;color:#dcdcdc;border:none;background-color:#013b1f;margin:0;padding:0}.julia_repl_NoFormat .akin_to_pre{line-height:1.35;color:#dcdcdc;margin:0;padding:0}.franklin_output_NoFormat{font-family:Consolas,monospace;margin:0;padding:0;background-color:#013b1f}.franklin_output_NoFormat pre{margin:0;padding:0;line-height:1.35;background-color:#013b1f}.franklin_output_NoFormat pre code{margin:0!important;padding:0!important;border:none;background-color:#013b1f}.mixed_output_NoFormat{font-family:Consolas,monospace;color:#dcdcdc;border:none;background-color:#013b1f;margin:0;padding:0}.mixed_output_NoFormat pre{line-height:1.35;color:#dcdcdc;margin:0;padding:0}.mixed_output_NoFormat pre code{margin:0!important;padding:0!important;border:none;background-color:#013b1f}.mixed_output_inline{color:#dcdcdc;font-family:Consolas,monospace;background-color:#013b1f;padding-left:1em;padding-top:.5em;padding-bottom:1em;margin-top:0;margin-bottom:0}.output_box{margin:0;padding:0}.output_box details>summary{width:max-content;max-width:90%;padding-left:10px;padding-right:10px;background-color:#3f6b4b;cursor:pointer;color:#fff;box-shadow:3px 3px 4px #000;text-indent:0}.output_box details[open]>summary{width:max-content;max-width:90%;padding-left:10px;padding-right:10px;background-color:#3f6b4b;border:#282c34;border-width:1px;border-style:solid}.output_box{padding-top:.5em;padding-bottom:1em;margin-top:0;margin-bottom:1em}.code_NoFormat{line-height:1.45;margin:0;padding:0;background-color:#001029}.code_NoFormat pre{margin:0;padding:0;background-color:#001029}.code_NoFormat pre code{font-family:"Cascadia Mono",monospace;margin:0!important;padding:0!important;border:none;background-color:#001029}.code_NoFormat p{padding:0;margin:0}.code_inline{background-color:#001029;padding-left:1em;padding-top:.5em;padding-bottom:1em;margin-top:0;margin-bottom:0}.code_box{margin:0;padding:0}.code_box details>summary{width:max-content;max-width:90%;padding-left:10px;padding-right:10px;background-color:#3f6388;cursor:pointer;color:#fff;box-shadow:3px 3px 4px #000;text-indent:0}.code_box details[open]>summary{width:max-content;max-width:90%;padding-left:10px;padding-right:10px;background-color:#3f6388;border:#282c34;border-width:1px;border-style:solid}.code_box{padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:1em}.hide_tab{padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:1em}.hide_tab>details>summary{max-width:100%;min-width:30px;width:fit-content;padding-left:11px;padding-right:0;padding-bottom:0;background-color:#3f6388;cursor:pointer;color:#fff;text-indent:0;border:#282c34;border-width:1px;border-style:solid}.hide_tab>details[open]>summary .closed_text{display:none}.hide_tab>details>summary .closed_text{padding-left:1em;padding-right:1em;margin-left:.25em;display:inline-block;border-left:#282c34;border-width:1px;border-style:solid;border-bottom:none;border-top:none;border-right:none}.hide_tab>details[open]>summary{position:absolute;width:35px;max-width:90%;height:1.94em;padding-bottom:0;padding-top:3px;padding-left:12px;padding-right:5px;background-color:#3f6388;border:#282c34;border-width:1px;border-style:solid;border-bottom:none}.tab_wrapper{width:100%;display:inline-block}.tab_wrapper .tab_code_links{background-color:#001029}.tab_wrapper .tab_code_links .tablink{background-color:#3f6388;color:#fff;float:left;border:1px solid #000;outline:0;cursor:pointer;padding:2px 20px;width:max-content;height:auto}.tab_wrapper .tab_code_links .tablink.first_tab{padding-left:54px}.tab_wrapper .tab_code_links .tablink.active{font-weight:500;background-color:rgba(82,127,173,.836)}.tab_wrapper .tab_code_links .tablink:hover{background-color:rgba(82,127,173,.836)}.tab_wrapper .tabcontent{background-color:#001029;display:none;width:100%;float:left;margin:0;padding:0}.tab_wrapper .tabcontent.active{display:block}.code_in_modal{background-color:#001029;padding-left:1em;padding-top:.5em;padding-bottom:1em;margin-top:0;margin-bottom:0}.output_in_modal{background-color:#013b1f}.img_output,.img_output_in_modal{text-indent:0;margin:0;padding:0;background-color:#181818}.img_output_in_modal_old,.img_output_old{text-indent:0;margin:0;padding:0;background-color:#1e1e1e}.sign_output{color:#fff;width:100%;max-width:100%;height:auto;padding-bottom:0;padding-top:0;padding-left:12px;padding-right:12px;background-color:#3f6b4b;border:#282c34;border-width:1px;border-style:solid;margin-bottom:0;padding-top:0}.outputmodal_container{padding:0;margin:0}</style><style>.gif_output_in_modal{text-indent:0;margin:0;padding:0;background-color:#181818}.gif_output{position:relative;display:inline-block;cursor:pointer;margin:0;padding:0;max-width:100%}.gif-wrapper{display:block;visibility:hidden;margin:0;padding:0;max-width:100%}.gif-wrapper.playing{visibility:visible}.play-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:#181818;background-color:#000;display:flex;justify-content:center;align-items:center}.play-overlay.hidden{background:0 0}.play-button{background:0 0;border:none;color:#fff;cursor:pointer;padding:0;transform:scale(.5);transition:background .3s}.play-overlay.hidden .play-button{display:none}</style><script>function setMaxHeight(){const e=document.querySelectorAll(".gif-wrapper");let t=0;e.forEach(e=>{const o=e.offsetHeight;o>t&&(t=o)}),e.forEach(e=>{e.style.height=`${t}px`,e.style.width="auto"})}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".gif_output");let t=0;e.forEach(o=>{const n=o.querySelector(".gif-wrapper"),c=o.querySelector(".play-overlay");let l=!1;n.onload=function(){t++,t===e.length&&setMaxHeight()},o.addEventListener("click",function(){l?(n.classList.remove("playing"),c.classList.remove("hidden"),l=!1):(n.classList.add("playing"),c.classList.add("hidden"),l=!0)})})})</script><div class="bar_top"><ul><li><div style="text-indent:0"><button class="modalButton" style="background-color:transparent;color:#fff;display:block;margin-bottom:-2px"><img src="/julia_book/assets/icons/sheets01.png" style="width:auto;height:30px;opacity:.9;padding-bottom:5px;margin-left:0"> Sections</button></div><div class="modal" id="modal_bar"><div class="modal-content"><div class="modal-header"><h2 style="text-decoration:none"><span style="text-decoration:underline">PART II</span>: HIGH PERFORMANCE</h2></div><div class="modal-body"><div class="row"><div class="column"><div style="padding-bottom:.8em"></div><ul><li>7. <u>Introduction to Performance</u><ul><li><a href="/julia_book/PAGES/07a_overview/"><i>a</i>. Overview and Goals</a></li><br><li><a href="/julia_book/PAGES/07b_introPerformace/"><i>b</i>. When To Optimize Code?</a></li><br><li><a href="/julia_book/PAGES/07c_benchmarks/"><i>c</i>. Benchmarking Execution Time</a></li><br><li><a href="/julia_book/PAGES/07d_TS-onTypes/"><i>d</i>. Preliminaries on Types</a></li><br><li><a href="/julia_book/PAGES/07e_TS-onFunctions/"><i>e</i>. Functions: Type Inference and Multiple Dispatch</a></li><br></ul></li></ul></div><div class="column"><div style="padding-bottom:.8em"></div><ul><li>8. <u>Type Stability</u><ul><li><a href="/julia_book/PAGES/08a_overview/"><i>a</i>. Overview and Goals</a></li><br><li><a href="/julia_book/PAGES/08b_TS-definition/"><i>b</i>. Defining Type Stability</a></li><br><li><a href="/julia_book/PAGES/08c_TS-scalarsVectors/"><i>c</i>. Type Stability with Scalars and Vectors</a></li><br><li><a href="/julia_book/PAGES/08d_TS-globalVariables/"><i>d</i>. Type Stability with Global Variables</a></li><br><li><a href="/julia_book/PAGES/08e_TS-barrierFunctions/"><i>e</i>. Barrier Functions</a></li><br><li><a href="/julia_book/PAGES/08f_TS-tuples/"><i>f</i>. Type Stability with Tuples</a></li><br><li><a href="/julia_book/PAGES/08g_TS-highOrderFunctions/"><i>g</i>. Type Stability with Higher-Order Functions</a></li><br><li><a href="/julia_book/PAGES/08h_TS-gotchas/"><i>h</i>. Gotchas for Type Stability</a></li><br></ul></li></ul></div><div class="column"><div style="padding-bottom:.8em"></div><ul><li>9. <u>Reducing Memory Allocations</u><ul><li><a href="/julia_book/PAGES/09a_overview/"><i>a</i>. Overview and Goals</a></li><br><li><a href="/julia_book/PAGES/09b_onAllocations/"><i>b</i>. Stack vs Heap</a></li><br><li><a href="/julia_book/PAGES/09c_objectsAllocating/"><i>c</i>. Objects Allocating Memory</a></li><br><li><a href="/julia_book/PAGES/09d_views/"><i>d</i>. Slice Views to Decrease Allocations</a></li><br><li><a href="/julia_book/PAGES/09e_preallocations/"><i>e</i>. Pre-Allocations</a></li><br><li><a href="/julia_book/PAGES/09f_reductions/"><i>f</i>. Reductions</a></li><br><li><a href="/julia_book/PAGES/09g_staticVectors/"><i>g</i>. Static Vectors for Small Collections</a></li><br><li><a href="/julia_book/PAGES/09h_lazyOperations/"><i>h</i>. Lazy Operations</a></li><br><li><a href="/julia_book/PAGES/09i_lazyBroadcasting/"><i>i</i>. Lazy Broadcasting and Loop Fusion</a></li><br></ul></li></ul></div></div><div class="row"><div class="column"><div style="padding-bottom:.8em"></div><ul><li>10. <u>Vectorization (SIMD)</u><ul><li><a href="/julia_book/PAGES/10a_overview/"><i>a</i>. Overview and Goals</a></li><br><li><a href="/julia_book/PAGES/10b_macrosAlgorithms/"><i>b</i>. Macros as a Means for Optimizations</a></li><br><li><a href="/julia_book/PAGES/10c_simd_intro/"><i>c</i>. Introduction to SIMD</a></li><br><li><a href="/julia_book/PAGES/10d_simd_independence/"><i>d</i>. SIMD: Independence of Iterations</a></li><br><li><a href="/julia_book/PAGES/10e_simd_unitStrides/"><i>e</i>. SIMD: Contiguous Access and Unit Strides</a></li><br><li><a href="/julia_book/PAGES/10f_simd_branchless/"><i>f</i>. SIMD: Branchless Code</a></li><br><li><a href="/julia_book/PAGES/10g_simd_LoopVectorization/"><i>g</i>. SIMD Packages</a></li><br></ul></li></ul></div><div class="column"><div style="padding-bottom:.8em"></div><ul><li>11. <u>Multithreading</u><ul><li><a href="/julia_book/PAGES/11a_overview/"><i>a</i>. Overview and Goals</a></li><br><li><a href="/julia_book/PAGES/11b_multithread_intro/"><i>b</i>. Introduction to Multithreading</a></li><br><li><a href="/julia_book/PAGES/11c_multithread_tasks/"><i>c</i>. Task-Based Parallelism: @spawn</a></li><br><li><a href="/julia_book/PAGES/11d_multithread_safe/"><i>d</i>. Thread-Safe Operations</a></li><br><li><a href="/julia_book/PAGES/11e_multithread_loops/"><i>e</i>. Parallel For-Loops: @threads</a></li><br><li><a href="/julia_book/PAGES/11f_multithread_apply/"><i>f</i>. Parallelization in Practice</a></li><br><li><a href="/julia_book/PAGES/11g_multithread_packages/"><i>g</i>. Multithreading Packages</a></li><br></ul></li></ul></div><div class="column"><div style="padding-bottom:.8em"></div></div></div></div></div></div></li></ul></div><style>.bar_top{padding-left:160px}.bar_top{background-image:linear-gradient(to right,#000,#000 10%,#3f6388 55%,#3f6388);position:fixed;width:100%;height:48px;top:0;left:0;padding:8px 0 10px 0;font-size:110%;z-index:125;font-family:Inter}.bar_top a:hover{color:#a09f9f}.bar_top>ul{list-style-type:none;float:left;position:relative;bottom:0;padding-left:1%;left:160px}.bar_top li a{color:#fff}.bar_top .modal{background-color:transparent;margin-top:48px;padding-left:1%;margin-left:0;width:100%;height:100%;overflow:auto;position:fixed}.bar_top .modal-content{position:relative;width:1200px;max-width:90%;height:max-content;max-height:90%;background-color:#000;margin:auto;padding:8px;margin-left:160px;-webkit-animation-name:none;animation-name:none}.bar_top .modal-header{background-color:#000;color:#fff}.bar_top .modal-body{color:#649dd6}.bar_top .modal-body .row{display:flex}.bar_top .modal-body .row .column{flex:1}.bar_top .modal-body .row h3{padding-bottom:.5em}.bar_top .modal-body .row ul li{line-height:1}.bar_top .modal-body .row ul li ul{list-style-type:none;margin:0;padding:0;padding-top:.5em;padding-bottom:.4em;line-height:1}.bar_top .modal-body .row ul li ul li{line-height:1}.bar_top .modal-body .row li{line-height:1;list-style-type:none;float:center;text-indent:-20px;padding-left:22px;position:relative}.bar_top .modal-body .row .column{text-align:center}.bar_top .modal-body .row .column h3{text-align:center}.bar_top .modal-body .row .column ul{text-align:left;margin-left:auto;margin-right:auto;list-style-position:inside;line-height:.55em}.bar_top .modalButton{border:none;margin-bottom:24px;box-shadow:none}.bar_top .modalClose{font-size:0px}</style><style>.footn{position:relative;display:inline-block;margin-left:-.6em;margin-right:0;color:#2669dd;text-decoration:underline}.supr{vertical-align:80%;font-size:75%;line-height:1}.footn .footn_text{font-size:125%;visibility:hidden;text-align:justify;text-justify:inter-word;text-indent:0;line-height:1.5;background-color:#282c34;color:#e0e4eb;border-radius:6px;padding:5px 12px 5px 12px;position:absolute;z-index:1;bottom:100%;right:0}.footn .footn_text.left{left:0;width:max-content;max-width:500px}.footn .footn_text.right{right:0;width:max-content;max-width:500px}.footn:hover .footn_text{visibility:visible}.footn a{color:#7b9fdd}.footn a:hover{color:#a1b6dbb2}</style><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script><script>$(document).ready(function(){$(".footn.supr").hover(function(){var t=$(this).find(".footn_text"),e=$(this).closest("p"),o=e.width(),s=t.offset().left-e.offset().left>o/2;t.removeClass("left right"),s?t.addClass("right"):t.addClass("left"),t.addClass("hovering")},function(){$(this).find(".footn_text").removeClass("hovering"),$(this).find(".footn_text").removeClass("left right")})})</script><style>@media (max-width:768px){.footn .footn_text.left{left:0;width:max-content;max-width:200px}.footn .footn_text.right{right:0;width:max-content;max-width:200px}}</style><style>@media (max-width:850px){.jumbotron{font-size:90%!important}.franklin-content{font-size:100%!important}.franklin-content{padding-left:1%;padding-right:1%}.franklin-content .container{max-width:100%!important}.index_container,.index_container section{font-size:100%}.index_container{padding-left:1%;padding-right:1%}.index_container ul li{padding-right:5%;padding-left:0}.index_container ul{padding-right:0;padding-left:5%}.home_container section{font-size:100%;line-height:1.55em}.home_container ul li{padding-right:1%;padding-left:0}.home_container ul{padding-right:0;padding-left:0}.home_container .row li{padding-left:0;padding-bottom:1.55em;margin-left:0}.home_container .bullets_nomarker ul li p{line-height:1.55!important}.col-lg-.mx-auto{overflow:auto!important}.jumbotron{padding-left:60px!important;padding-right:1%!important;padding-top:0;margin-top:0}.modal{padding:2px!important}.bullets ol,.itemNoSpace ol{padding:4px}.bullets ul li,.itemNoSpace ul li{padding-right:5%;padding-left:0;margin-left:0}.bullets ul li p,.itemNoSpace ul li p{line-height:1.65}}@media (max-height:600px){.jumbotron{font-size:90%!important}.franklin-content{font-size:100%!important}.franklin-content .container{max-width:100%!important}.index_container,.index_container section{font-size:100%}.index_container ul li{padding-right:5%;padding-left:0}.index_container ul{padding-right:0;padding-left:5%}.index_container{padding-left:1%;padding-right:1%}.col-lg-.mx-auto{overflow:auto!important}.jumbotron{padding-left:60px!important;padding-right:1%!important;padding-top:0;margin-top:0}.franklin-content{padding-left:0!important}.modal{padding:2px!important}.bullets ol,.itemNoSpace ol{padding:6px}.bullets ul li,.itemNoSpace ul li{padding-right:5%;padding-left:0;margin-left:0}.bullets ul li p,.itemNoSpace ul li p{line-height:1.55}.index_container ul li{padding-right:5%;padding-left:0}.index_container ul{padding-right:0;padding-left:5%}}</style><div class="left_bar_mobile" style="color:#fff"><ul><li><a href="/julia_book/index.html"><img src="/julia_book/assets/icons/home.png" style="width:15%;height:auto;opacity:.9;padding-bottom:0"> HOME</a></li><li><a href="/julia_book/list_posts/"><img src="/julia_book/assets/icons/books03.png" style="width:15%;height:auto;opacity:.9;padding-bottom:0"> CHAPTERS</a></li><li><div class="dark-mode-mobile"><label class="switch"><input type="checkbox" class="toggleMobile"> <span class="slider round"></span></label></div></li></ul></div><style>@media (min-width:850px),(min-height:600px){.left_bar_mobile{display:none}}@media (max-width:850px),(max-height:600px){.left_bar_mobile{display:block}.left_bar_mobile img{display:none}.left_bar_mobile{z-index:200;background-image:none;position:absolute;font-family:Inter;height:160px!important;top:0;left:0;font-size:85% width : 60px}.left_bar_mobile ul{list-style-type:none;float:left;font-size:100%;position:relative;padding-left:.4em;padding-top:.2em;line-height:2em!important;height:100%;top:0;width:60px;display:flex;flex-direction:column;justify-content:space-around}.left_bar_mobile li{flex:1}.left_bar_mobile li a{color:#fff}.left_bar_mobile a:hover{color:#a09f9f}.dark-mode-mobile{position:relative;bottom:0;margin-top:auto}.dark-mode-mobile .switch{width:40px;height:20px}.dark-mode-mobile .slider:before{height:15px;width:15px}.dark-mode-mobile input:checked+.slider:before{transform:translateX(20px)}@media (max-width:850px),(max-height:600px){h2{font-size:140%;padding-top:1em}h1{font-size:180%;padding-top:.5em;padding-bottom:0}}}</style><style>@media (max-width:850px),(max-height:600px){.lead{display:none}.bar_top,.copy-button,.py-1 .container .center-text,nav{display:none!important}.jumbotron{padding-left:80px;padding-right:.1%!important;padding-top:0;margin-top:0}}</style><style>@media (min-width:850px),(min-height:600px){.dark-mode-mobile{visibility:hidden}}@media (max-width:850px),(max-height:600px){.dark-mode-mobile{visibility:visible}}</style><script>document.querySelector(".toggleMobile").addEventListener("change",function(){const e=document.documentElement;this.checked?(e.classList.add("dark-mode"),localStorage.setItem("darkMode","enabled")):(e.classList.remove("dark-mode"),localStorage.setItem("darkMode","disabled"))}),window.addEventListener("load",function(){const e=document.documentElement;"enabled"===localStorage.getItem("darkMode")?(document.querySelector(".toggleMobile").checked=!0,e.classList.add("dark-mode")):document.querySelector(".toggleMobile").checked=!1})</script><div class="franklin-content"><section id="introduction" class="scrollspy section-bg-color"><div class="container"><div class="row"><div class="col-lg- mx-auto"><h2>Introduction</h2><p></p><p>Parallelizing code may seem straightforward at a first glance. However, once we start delving into its subtleties, it&#39;s rapidly revealed that an effective implementation can be a daunting task. As we&#39;ve discussed, naive implementations can lead to various issues, including performance problems like suboptimal load balancing or false sharing, and more severe concerns such as data races. Furthermore, even if the necessary skills for a correct implementation were mastered, the added complexity can severely impair the code&#39;s readability and maintainability.</p><p>To assist users in overcoming these obstacles, several packages for parallelization have emerged. These tools aim to simplify the implementation of multithreading, allowing users to leverage its benefits without grappling with low-level intricacies. In this section, we&#39;ll present a few of these packages. In particular, the focus will be on those that facilitate the application of multithreading to embarrassingly parallel problems and reductions.</p><p>The first package we explore is <code>OhMyThreads</code>. This offers a collection of high-level functions and macros that help developers parallelize operations with minimal effort. For instance, it eliminates the need to manually partition tasks and tackles subtle performance issues like false sharing. We&#39;ll then examine the <code>Polyester</code> package. Thanks to its reduced overhead, this package is capable of streamlining parallelization for small objects. After this, we revisit the <code>LoopVectorization</code> package. In particular, we introduce the macro <code>@tturbo</code>, which combines the benefits of SIMD instructions with multithreading.</p><p></p></div></div></div></section><section id="package_ohmythreads" class="scrollspy"><div class="container"><div class="row"><div class="col-lg- mx-auto"><h2>Package "OhMyThreads"</h2><p></p><p>As the package&#39;s documentation claims, <a href="https://github.com/JuliaFolds2/OhMyThreads.jl"><code>OhMyThreads</code></a> aims to be a user-friendly package to seamlessly apply multithreading. Consistent with its minimalist approach, the package only introduces a handful of essential functionalities that could easily be part of Julia&#39;s <code>Base</code>. The goal is to allow users to implement code parallelization, even if they don&#39;t possess deep expertise in the subject.</p><p>Specifically, the package provides various higher-order functions and macros that internally handle data-race conditions and performance issues like false sharing. Despite its simplicity, <code>OhMyThreads</code> still covers a significant range of scenarios, even supporting reduction operations.</p><p>In the following, we present the main higher-functions provided by the package. Before introducing them, let&#39;s indicate several features that these functions share. Firstly, their names in <code>OhMyThreads</code> mirror those in <code>Base</code>, but adding a prefix of <code>t</code>. For instance, the counterpart to <code>map</code> is <code>tmap</code>. Secondly, <code>OhMyThreads</code> offers the option of customizing the parallelization process. This is achieved through an integration with <code>ChunkSplitters</code>, enabling customized work distributions among tasks via two keyword arguments: <code>nchunks</code>&#40;or equivalently <code>ntasks</code>&#41; to define the number of subsets in the partition, and <code>chunksize</code> to specify the number of elements in each subset.</p><div class="warning"><div class="title"><span class="warning_title" style="font-weight:500"><img src="/julia_book/assets/icons/warning.png" style="width:auto;height:30px;opacity:.99;padding-bottom:4px;margin-left:-4px"> <b>Warning!</b></span></div><div class="content">All the code snippets below assume you&#39;ve already loaded the package with <code>using OhMyThreads</code>.</div></div><h4>Parallel Mapping</h4><p>The <code>tmap</code> function serves as the multithreaded counterpart to <code>map</code>. Its syntax is <code>tmap&#40;foo, x&#41;</code>, where <code>foo</code> is the transforming function applied to each element of the collection <code>x</code>. Unfortunately, applying <code>tmap</code> in this form results in a performance loss. This is due to a technicality, arising from the type instability of the object <code>Task</code>.</p><p>To circumvent this issue and regain the lost performance, we must then explicitly indicate the output&#39;s type. To do this, we need the function method <code>tmap&#40;foo, T , x&#41;</code>, where <code>T</code> represents the <em>element type</em> of the output. Thus, if for instance the output is a <code>Vector&#123;Float64&#125;</code>, <code>T</code> would be <code>Float64</code>. Instead of directly declaring <code>T</code>, a more flexible alternative is to use <code>eltype&#40;x&#41;</code>, making the output&#39;s type mirror that of <code>x</code>.</p><p>The package also provides an in-place version, <code>tmap&#33;</code>. In this case, since <code>tmap&#33;</code> requires specifying the output vector, there&#39;s no need to do any extra work to avoid performance losses.</p><p>Below, we illustrate the application of these functions. To provide a basis for comparison, we include results of <code>map</code> and <code>map&#33;</code> as single-threaded baselines.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Multithreaded map</button> <button class="tablink" data-id="">Multithreaded map!</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x                       &#61; rand&#40;1_000_000&#41;


foo&#40;x&#41;                  &#61;  map&#40;log, x&#41;
foo_parallel1&#40;x&#41;        &#61; tmap&#40;log, x&#41;
foo_parallel2&#40;x&#41;        &#61; tmap&#40;log, eltype&#40;x&#41;, x&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.254 ms (2 allocations: 7.629 MiB)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel1&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.494 ms (568 allocations: 16.958 MiB)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel2&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  337.724 Î¼s (155 allocations: 7.642 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x                       &#61; rand&#40;1_000_000&#41;
output                  &#61; similar&#40;x&#41;

foo&#33;&#40;output,x&#41;          &#61;  map&#33;&#40;log, output, x&#41;
foo_parallel&#33;&#40;output,x&#41; &#61; tmap&#33;&#40;log, output, x&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.303 ms (0 allocations: 0 bytes)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel&#33;&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  334.747 Î¼s (150 allocations: 13.188 KiB)
</code></pre></div></div></div></div></div><p></p></details></div><p><code>OhMyThreads</code> additionally provides the option to control the work distribution among tasks. This is done through the keyword arguments <code>nchunks</code> and <code>chunksize</code>, which are internally implemented via the package <code>ChunkSplitters</code>. Specifically, <code>nchunks</code> controls the number of subsets in the partition, while <code>chunksize</code> sets the number of elements per task. Note that <code>nchunks</code> and <code>chunksize</code> are mutually exclusive options, so that only one of them can be used at a time.</p><p></p><div class="own-anchors"><a name="example_above"></a></div>To illustrate the use <code>nchunks</code>, we&#39;ll set its value equal to <code>nthreads&#40;&#41;</code>. By setting a number of chunks equal to the number of worker threads, we&#39;re adopting an even distribution among tasks, similar to how <code>@threads</code> operates. To set the same number with <code>chunksize</code>, we&#39;ll make use of the floor division operator <code>Ã·</code>. This is a binary operator that rounds a division down to the nearest integer towards zero. <span class="footn supr">&#91;note&#93; <span class="footn_text">For example, <code>5 Ã· 3</code> would return <code>1</code>.</span></span><p></p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Number of Chunks</button> <button class="tablink" data-id="">Size of Chunks</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x      &#61; rand&#40;1_000_000&#41;

foo&#40;x&#41; &#61; tmap&#40;log, eltype&#40;x&#41;, x; nchunks &#61; nthreads&#40;&#41;&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  339.006 Î¼s (155 allocations: 7.642 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x      &#61; rand&#40;1_000_000&#41;

foo&#40;x&#41; &#61; tmap&#40;log, eltype&#40;x&#41;, x; chunksize &#61; length&#40;x&#41; Ã· nthreads&#40;&#41;&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  355.825 Î¼s (164 allocations: 7.643 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><div class="note"><div class="title"><span class="note_title" style="font-weight:500"><img src="/julia_book/assets/icons/exclamation.png" style="width:auto;height:30px;opacity:.99;padding-bottom:4px;margin-left:-4px;padding-right:.4em"><strong>Do-Block Syntax</strong></span></div><div class="content">When <code>tmap</code> requires passing more complex functions, we can still use an anonymous function. In this case, the <a href="/julia_book/PAGES/03c_functions/#do-syntax">do-block syntax</a> comes in handy. It enables the creation of multi-line functions, making code more readable. Below, we show an example.<p></p><p></p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Anonymous Function</button> <button class="tablink" data-id="">Do-Block Syntax</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    
    output &#61; tmap&#40;a -&gt; 2 * log&#40;a&#41;, x&#41;



    return output
end</code></pre></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;    
    
    output &#61; tmap&#40;x&#41; do a
                2 * log&#40;a&#41;
             end

    return output
end</code></pre></div></div></div></div><p></p></details></div></div></div><h4>Array Comprehensions</h4><p><code>OhMyThreads</code> also provides an alternative to <code>tmap</code> via array comprehensions. Unlike the standard implementation in <code>Base</code>, the version from <code>OhMyThreads</code> combines a multithreaded variant of <code>collect</code> with a generator. Similarly to <code>tmap</code>, specifying the output&#39;s element type is necessary to prevent performance losses.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Multithreaded Array Comprehension</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x                &#61; rand&#40;1_000_000&#41;
output           &#61; similar&#40;x&#41;

foo&#40;x&#41;           &#61; &#91;log&#40;a&#41; for a in x&#93;
foo_parallel1&#40;x&#41; &#61; tcollect&#40;log&#40;a&#41; for a in x&#41;
foo_parallel2&#40;x&#41; &#61; tcollect&#40;eltype&#40;x&#41;, log&#40;a&#41; for a in x&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.231 ms (2 allocations: 7.629 MiB)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel1&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.489 ms (568 allocations: 16.958 MiB)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel2&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  336.948 Î¼s (155 allocations: 7.642 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><h4>Reductions and Map-Reductions</h4><p><code>OhMyThreads</code> also offers multithreaded versions of <code>reduce</code> and <code>mapreduce</code>. They&#39;re respectively referred to as <code>treduce</code> and <code>tmapreduce</code>. These functions internally handle the race conditions inherent in reductions and address performance issues like false sharing. Notably, unlike <code>map</code>, these functions can achieve optimal performance without requiring a specified output type.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Multithreaded Map</button> <button class="tablink" data-id="">Multithreaded Array Comprehension</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x               &#61; rand&#40;1_000_000&#41;

foo&#40;x&#41;          &#61;  reduce&#40;&#43;, x&#41;
foo_parallel&#40;x&#41; &#61; treduce&#40;&#43;, x&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  86.102 Î¼s (0 allocations: 0 bytes)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  29.542 Î¼s (513 allocations: 43.047 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x               &#61; rand&#40;1_000_000&#41;

foo&#40;x&#41;          &#61;  mapreduce&#40;log, &#43;, x&#41;
foo_parallel&#40;x&#41; &#61; tmapreduce&#40;log, &#43;, x&#41;</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.385 ms (0 allocations: 0 bytes)
</code></pre></div><p></p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo_parallel&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  389.624 Î¼s (511 allocations: 43.000 KiB)
</code></pre></div></div></div></div></div><p></p></details></div><h4>Foreach As A Faster Option for Mappings</h4><p>The package also offers an implementation similar to for-loops through the function <code>tforeach</code>. Since we haven&#39;t covered the single-threaded version <code>foreach</code>, we begin by presenting it. The function follows a syntax identical to <code>map</code>, and is usually implemented using a <a href="/julia_book/PAGES/03c_functions/#do-syntax">do-block syntax</a>, as shown below.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">For-Loop</button> <button class="tablink" data-id="">foreach (anonymous function)</button> <button class="tablink" data-id="">foreach (do-block syntax)</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.329 ms (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    foreach&#40;i -&gt; output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;, eachindex&#40;x&#41;&#41;
        
    

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.251 ms (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    foreach&#40;eachindex&#40;x&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.265 ms (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><p>Despite the similarities of <code>tforeach</code> and <code>tmap</code>, <code>tforeach</code> is more performant. Furthermore, it doesn&#39;t incur a performance penalty when the output type isn&#39;t specified.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">For-Loop (single-threaded)</button> <button class="tablink" data-id="">tmap</button> <button class="tablink" data-id="">tmap (with output's type)</button> <button class="tablink" data-id="">tforeach</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.281 ms (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    tmap&#40;eachindex&#40;x&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.868 ms (571 allocations: 24.589 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    tmap&#40;eltype&#40;x&#41;, eachindex&#40;x&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  582.144 Î¼s (158 allocations: 15.272 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    tmap&#40;eltype&#40;x&#41;, eachindex&#40;x&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  582.144 Î¼s (158 allocations: 15.272 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><p>Just like <code>tmap</code>, <code>tforeach</code> offers the keyword arguments <code>nchunks</code> and <code>chunksize</code> to control the workload distribution among worker threads. For the illustration, we use a distribution analogous to <a href="#example_above">the one used above</a> for <code>tmap</code>.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Number of Chunks</button> <button class="tablink" data-id="">Size of Chunks</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    tforeach&#40;eachindex&#40;x&#41;; nchunks &#61; nthreads&#40;&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  340.708 Î¼s (154 allocations: 7.642 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    tforeach&#40;eachindex&#40;x&#41;; chunksize &#61; length&#40;x&#41; Ã· nthreads&#40;&#41;&#41; do i
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  358.567 Î¼s (161 allocations: 7.643 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><p></p></div></div></div></section><section id="polyester_parallelization_for_small_objects" class="scrollspy section-bg-color"><div class="container"><div class="row"><div class="col-lg- mx-auto"><h2>Polyester: Parallelization for Small Objects</h2><p></p><div class="warning"><div class="title"><span class="warning_title" style="font-weight:500"><img src="/julia_book/assets/icons/warning.png" style="width:auto;height:30px;opacity:.99;padding-bottom:4px;margin-left:-4px"> <b>Warning!</b></span></div><div class="content">All the code snippets below assume you executed <code>using Polyester</code> to load the package.</div></div><p>One key limitation of multithreading is its overhead due to the creation and scheduling of tasks. This issue can render parallelization impractical for smaller computational tasks, as the cost of thread management would outweigh any potential performance gain. Considering this, the application of multithreading is commonly reserved for objects sufficiently large to justify the cost.</p><p>The <code>Polyester</code> package addresses this limitation by implementing techniques that reduce the overhead. In this way, it becomes possible to parallelize objects that, otherwise, would be deemed too small to benefit from multithreading. Importantly, the package requires expressing the code to be parallelized as a for-loop.</p><p>To illustrate the benefits of the package, let&#39;s compare its performance to traditional methods. The following example considers a for-loop with 500 iterations, a relatively low number for applying multithreading. Indeed, the first tab shows that an approach based on <code>@threads</code> is slower than its single-threaded variant. In contrast, <code>Polyester</code> achieves comparable performance to the single-threaded variant, despite the low number of iterations. To use <code>Polyseter</code>, we simply need to prefix the for-loop with the <code>@batch</code> macro.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">For-Loop (single-threaded)</button> <button class="tablink" data-id="">@threads</button> <button class="tablink" data-id="">@floop</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;500&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.552 Î¼s (1 allocations: 4.062 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;500&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @threads for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  9.362 Î¼s (122 allocations: 16.672 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;500&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @batch for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  992.000 ns (1 allocations: 4.062 KiB)
</code></pre></div></div></div></div></div><p></p></details></div><p>For larger objects, it&#39;s worth noting that <code>Polyester</code> may not necessarily outperform &#40;or underperform&#41; alternative methods. In such cases, it&#39;s recommend benchmarking your particular application.</p><h4>Reductions</h4><p><code>Polyester</code> also supports reduction operations. These can be implemented by prepending the for-loop with the expression <code>@batch reduce&#61;&#40;&lt;tuple with operation and variable reduced&gt;&#41;</code>. Notably, Polyester&#39;s implementation has been designed to avoid common pitfalls of reductions, such as data races and false sharing, ensuring both correctness and performance. The following example illustrates its application.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Single Threaded</button> <button class="tablink" data-id="">@batch</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;250&#41;

function foo&#40;x&#41;
    output &#61; 0.0
    
    for i in eachindex&#40;x&#41;
        output &#43;&#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  745.289 ns (0 allocations: 0 bytes)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;250&#41;

function foo&#40;x&#41;
    output &#61; 0.0
    
    @batch reduction&#61;&#40; &#40;&#43;, output&#41; &#41; for i in eachindex&#40;x&#41;
        output &#43;&#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  543.889 ns (0 allocations: 0 bytes)
</code></pre></div></div></div></div></div><p></p></details></div><p>We can also incorporate more than one reduction operation per iteration, as demonstrated below.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Single Threaded</button> <button class="tablink" data-id="">@batch</button> <button class="tablink" data-id="">@batch (equivalent)</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;250&#41;

function foo&#40;x&#41;
    output1 &#61; 1.0
    output2 &#61; 0.0
    
    for i in eachindex&#40;x&#41;
        output1 *&#61; log&#40;x&#91;i&#93;&#41;
        output2 &#43;&#61; exp&#40;x&#91;i&#93;&#41;
    end
    
    return output1, output2
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.241 Î¼s (0 allocations: 0 bytes)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;250&#41;

function foo&#40;x&#41;
    output1 &#61; 1.0
    output2 &#61; 0.0
    
    @batch reduction&#61;&#40; &#40;*, output1&#41;, &#40;&#43;, output2&#41; &#41; for i in eachindex&#40;x&#41;
        output1 *&#61; log&#40;x&#91;i&#93;&#41;
        output2 &#43;&#61; exp&#40;x&#91;i&#93;&#41;
    end
    
    return output1, output2
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  630.302 ns (0 allocations: 0 bytes)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;250&#41;

function foo&#40;x&#41;
    output1 &#61; 1.0
    output2 &#61; 0.0
    
    @batch reduction&#61;&#40; &#40;*, output1&#41;, &#40;&#43;, output2&#41; &#41; for i in eachindex&#40;x&#41;
        output1  &#61; output1 * log&#40;x&#91;i&#93;&#41;
        output2  &#61; output2 &#43; exp&#40;x&#91;i&#93;&#41;
    end
    
    return output1, output2
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>@btime foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  641.075 ns (0 allocations: 0 bytes)
</code></pre></div></div></div></div></div><p></p></details></div><h4>Local Variables</h4><p><code>Polyester</code> also treats variables as local per iteration, unlike <code>@threads</code>.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Single Threaded</button> <button class="tablink" data-id="">@threads (ok)</button> <button class="tablink" data-id="">@threads (data race)</button> <button class="tablink" data-id="">@batch (ok)</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function foo&#40;&#41;
    out  &#61; zeros&#40;Int, 2&#41;
    temp &#61; 0

    for i in 1:2
        temp   &#61; i; sleep&#40;i&#41;
        out&#91;i&#93; &#61; temp
    end

    return out
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">2-element Vector{Int64}:
 1
 2</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function foo&#40;&#41;
    out  &#61; zeros&#40;Int, 2&#41;
    

    @threads for i in 1:2
        temp   &#61; i; sleep&#40;i&#41;
        out&#91;i&#93; &#61; temp
    end

    return out
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">2-element Vector{Int64}:
 1
 2</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function foo&#40;&#41;
    out  &#61; zeros&#40;Int, 2&#41;
    temp &#61; 0

    @threads for i in 1:2
        temp   &#61; i; sleep&#40;i&#41;
        out&#91;i&#93; &#61; temp
    end

    return out
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">2-element Vector{Int64}:
 2
 2</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function foo&#40;&#41;
    out  &#61; zeros&#40;Int, 2&#41;
    temp &#61; 0

    @batch for i in 1:2
        temp   &#61; i; sleep&#40;i&#41;
        out&#91;i&#93; &#61; temp
    end

    return out
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">2-element Vector{Int64}:
 1
 2</code></pre></div></div></div></div></div><p></p></details></div><p></p></div></div></div></section><section id="simd_multithreading" class="scrollspy"><div class="container"><div class="row"><div class="col-lg- mx-auto"><h2>SIMD + Multithreading</h2><p></p><div class="warning"><div class="title"><span class="warning_title" style="font-weight:500"><img src="/julia_book/assets/icons/warning.png" style="width:auto;height:30px;opacity:.99;padding-bottom:4px;margin-left:-4px"> <b>Warning!</b></span></div><div class="content">All the code snippets below assume you&#39;ve already loaded the package with <code>using LoopVectorization</code>.</div></div><p>We&#39;ve already covered the package <code>LoopVectorization</code> in the <a href="/julia_book/PAGES/10c_simd">section about SIMD instructions</a>. We now revisit this package to demonstrate its ability to combine SIMD with multithreading. The feature is achieved through integration with the <code>Polyester</code> package.</p><p>The primary approach to implementing the functionality involves the <code>@tturbo</code> macro, which provides a parallelized version of <code>@turbo</code>. Unlike the @<code>threads</code> macro, where the application of SIMD optimizations is left to the compiler&#39;s discretion, <code>@tturbo</code> automatically applies SIMD.</p><p>To illustrate the benefits of <code>@tturbo</code>, let&#39;s consider an example scenario where SIMD isn&#39;t applied automatically by <code>@threads</code>, despite that the operation is well-suited for this purpose.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">Single Threaded</button> <button class="tablink" data-id="">@threads</button> <button class="tablink" data-id="">@tturbo</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; BitVector&#40;rand&#40;Bool, 100_000&#41;&#41;
y &#61; rand&#40;100_000&#41;

function foo&#40;x,y&#41;
    output &#61; similar&#40;y&#41;

    for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; ifelse&#40;x&#91;i&#93;, log&#40;y&#91;i&#93;&#41;, y&#91;i&#93; * 2&#41;
    end

    output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  587.694 Î¼s (2 allocations: 781.297 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; BitVector&#40;rand&#40;Bool, 100_000&#41;&#41;
y &#61; rand&#40;100_000&#41;

function foo&#40;x,y&#41;
    output &#61; similar&#40;y&#41;

    @threads for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; ifelse&#40;x&#91;i&#93;, log&#40;y&#91;i&#93;&#41;, y&#91;i&#93; * 2&#41;
    end

    output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  80.625 Î¼s (123 allocations: 793.906 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; BitVector&#40;rand&#40;Bool, 100_000&#41;&#41;
y &#61; rand&#40;100_000&#41;

function foo&#40;x,y&#41;
    output &#61; similar&#40;y&#41;

    @tturbo for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; ifelse&#40;x&#91;i&#93;, log&#40;y&#91;i&#93;&#41;, y&#91;i&#93; * 2&#41;
    end

    output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  57.225 Î¼s (2 allocations: 781.297 KiB)
</code></pre></div></div></div></div></div><p></p></details></div><p>The @<code>tturbo</code> macro is also available as a broadcasting version. Although the for-loop implementation could be more performant in some scenarios, the broadcasting variant significantly simplifies the syntax. Furthermore, it&#39;s particularly useful for parallelizing broadcasting operations, since no built-in macro currently exists for this purpose. Below, we provide a simple example that demonstrates the improvement in readability achieved by using this variant.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">@tturbo (For-Loop)</button> <button class="tablink" data-id="">@tturbo (Broadcasting)</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x      &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;

    @tturbo for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41; / x&#91;i&#93;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  525.304 Î¼s (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x      &#61; rand&#40;1_000_000&#41;

foo&#40;x&#41; &#61; @tturbo log.&#40;x&#41; ./ x</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  524.273 Î¼s (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><p></p></div></div></div></section><section id="floops_parallel_for-loops_i_stylecolorredoptional" class="scrollspy section-bg-color"><div class="container"><div class="row"><div class="col-lg- mx-auto"><h2>FLoops: Parallel For-Loops (<strong><i style="color:red">OPTIONAL</i></strong>)</h2><p></p><div class="warning"><div class="title"><span class="warning_title" style="font-weight:500"><img src="/julia_book/assets/icons/warning.png" style="width:auto;height:30px;opacity:.99;padding-bottom:4px;margin-left:-4px"> <b>Warning!</b></span></div><div class="content">All the code snippets below assume you&#39;ve already loaded the package by executing <code>using FLoops</code>.</div></div><p>We conclude this section with a brief overview of the package <code>FLoops</code>. The presentation is labeled as optional since its use beyond simple applications could require <a href="https://juliafolds.github.io/FLoops.jl/stable/howto/avoid-box/">some workarounds</a>. Moreover, it appears not to be actively maintained.</p><p>The primary macro provided by the package is <code>@floop</code>, exclusively designed to parallelize for-loops. An example of its usage is provided below.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">For-Loop (single-threaded)</button> <button class="tablink" data-id="">@floop</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;

    for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.353 ms (2 allocations: 7.629 MiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @floop for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  388.563 Î¼s (157 allocations: 7.645 MiB)
</code></pre></div></div></div></div></div><p></p></details></div><p><code>@floop</code> can also be used for reductions by including <code>@reduce</code> at the beginning of the line with a reduction operation. The macro addresses the inherent data race of reductions and avoids false sharing issues.</p><div class="hide_tab"><details open><summary><div class="closed_text"></div></summary><p></p><div class="tab_wrapper"><div class="tab_code_links"><button class="tablink first_tab active" data-id="">For-Loop (single-threaded)</button> <button class="tablink" data-id="">False Sharing</button> <button class="tablink" data-id="">@floop</button></div><div data-id="" class="tabcontent active"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; 0.0

    for i in eachindex&#40;x&#41;
        output &#43;&#61; log&#40;x&#91;i&#93;&#41;
    end

    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  3.396 ms (0 allocations: 0 bytes)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; zeros&#40;length&#40;chunk_ranges&#41;&#41;
    
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        for j in chunk
            partial_outputs&#91;i&#93; &#43;&#61; log&#40;x&#91;j&#93;&#41;
        end
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  1.314 ms (122 allocations: 13.234 KiB)
</code></pre></div></div></div></div><div data-id="" class="tabcontent"><div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;1_000_000&#41;

function foo&#40;x&#41;
    output &#61; 0.0
    
    @floop for i in eachindex&#40;x&#41;
        @reduce output &#43;&#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre></div></div><div class="output_in_modal"><div class="sign_output">Output in REPL</div><div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div><code>foo&#40;&#36;x&#41;</code><br><pre><code class="plaintext code-output">  370.835 Î¼s (252 allocations: 17.516 KiB)
</code></pre></div></div></div></div></div><p></p></details></div><p></p></div></div></div></section><footer class="py-1"><div class="container"><span class="left-text"><a href="/julia_book/PAGES/11f_multithread_apply" class="prevPage"><img src="/julia_book/assets/icons/prev-page.png" style="width:50px;height:auto;opacity:.9;padding-bottom:5px"> Previous Section <span class="ctrl-text">( <kbd>Ctrl + <img src="/julia_book/assets/icons/arrow_left.png" style="width:15px;height:auto;opacity:.9;padding-bottom:2px"> </kbd>)</span> </a></span><span class="right-text"><a href="/julia_book/" class="nextPage">Next Section <span class="ctrl-text">( <kbd>Ctrl + <img src="/julia_book/assets/icons/arrow_right.png" style="width:15px;height:auto;opacity:.9;padding-bottom:2px"> </kbd>)</span> <img src="/julia_book/assets/icons/next-page.png" style="width:50px;height:auto;opacity:.9;padding-bottom:5px"> </a></span><span class="center-text">Â© Martin Alfaro<br>Last Modified October 4, 2025</span></div></footer><style>@media (max-width:850px),(max-height:600px){.ctrl-text{display:none}}footer{font-family:Inter}footer .container{width:100%;margin-top:.6em;margin-bottom:.5em;overflow:hidden;text-align:center;align-items:center;justify-content:center;color:#fff}footer .center-text{text-align:center}footer .left-text{float:left}footer .right-text{float:right}footer a{color:#fff}footer a:hover{color:#fff;opacity:.9;text-decoration:none}</style><script>const prevPageURL=document.querySelector(".prevPage").href,nextPageURL=document.querySelector(".nextPage").href;function goToPrevPage(){window.location=prevPageURL}function goToNextPage(){window.location=nextPageURL}document.querySelector(".prevPage").addEventListener("click",goToPrevPage),document.querySelector(".nextPage").addEventListener("click",goToNextPage),document.addEventListener("keyup",e=>{"ArrowLeft"===e.key&&e.ctrlKey?goToPrevPage():"ArrowRight"===e.key&&e.ctrlKey&&goToNextPage()})</script></div><script src="/julia_book/libs/katex/katex.min.js"></script><script src="/julia_book/libs/katex/auto-render.min.js"></script><script>renderMathInElement(document.body)</script><script src="/julia_book/libs/highlight/highlight.js"></script><script>hljs.highlightAll(),hljs.configure({tabReplace:"    "})</script><script src="/julia_book/libs/simple-scrollspy.min.js"></script><script>window.onload=function(){scrollSpy("#navbarResponsive",{sectionClass:".scrollspy",menuActiveTarget:".nav-link",offset:100})}</script></body></html><!-- 
#################################################
# FOR ALL PAGES
################################################# 
--><script>const btns=document.getElementsByClassName("modalButton"),modals=document.getElementsByClassName("modal");[...btns].forEach((e,t)=>{e.onclick=()=>{"block"===modals[t].style.display?modals[t].style.display="none":modals[t].style.display="block"}}),window.addEventListener("click",function(e){const t=document.getElementsByClassName("modal"),l=document.getElementsByClassName("modal-content"),n=document.getElementsByClassName("modalButton");for(let s=0;s<t.length;s++){const o=t[s],a=l[s],d=n[s];"block"!==o.style.display||a.contains(e.target)||d.contains(e.target)||(o.style.display="none")}}),document.addEventListener("keydown",function(e){if(e.ctrlKey&&"z"===e.key){const e=document.getElementById("modal_bar");e&&"block"===e.style.display?e.style.display="none":e.style.display="block"}})</script><script>let handleClick=e=>{Array.from(e.target.parentElement.parentElement.querySelectorAll(".active"),e=>e.classList.remove("active")),e.target.classList.add("active"),document.querySelector(`div.tabcontent[data-id*="${e.target.dataset.id}"]`).classList.add("active")};Array.from(document.getElementsByClassName("tablink"),e=>e.addEventListener("click",handleClick,!1))</script><script>let setHeight=()=>{document.querySelectorAll(".tab_wrapper").forEach(e=>{let t=e.querySelectorAll(".tabcontent"),i=0,l=0;t.forEach(e=>{let t=e.style.visibility;e.style.visibility="visible";let o=e.style.position,s=e.style.display;e.style.position="relative",e.style.display="inline-block";let y=e.querySelector(".code_in_modal"),r=e.querySelector(".output_in_modal");if(y){y.style.height="auto";let e=y.offsetHeight;e>i&&(i=e)}if(r){r.style.height="auto";let e=r.offsetHeight;e>l&&(l=e)}e.style.visibility=t,e.style.position=o,e.style.display=s}),t.forEach(e=>{let t=e.querySelector(".code_in_modal"),o=e.querySelector(".output_in_modal");t&&(t.style.height=i+"px"),o&&(o.style.height=l+"px")})})};window.addEventListener("load",setHeight),window.addEventListener("resize",setHeight)</script><script>for(var tabWrappers=document.getElementsByClassName("tab_wrapper"),i=0;i<tabWrappers.length;i++)for(var tabWrapper=tabWrappers[i],buttons=tabWrapper.getElementsByClassName("tablink"),tabContents=tabWrapper.getElementsByClassName("tabcontent"),j=0;j<buttons.length;j++){var button=buttons[j],tabContent=tabContents[j],dataId="tab"+(i+1)+"_"+(j+1);button.setAttribute("data-id",dataId),tabContent.setAttribute("data-id",dataId)}</script><script>document.addEventListener("keydown",function(e){if("ArrowUp"===e.code&&e.altKey)for(var n=document.getElementsByTagName("details"),t=0;t<n.length;t++)n[t].open=!1})</script><script>document.addEventListener("keydown",function(e){if("ArrowDown"===e.code&&e.altKey)for(var n=document.getElementsByTagName("details"),o=0;o<n.length;o++)n[o].open=!0}),window.onkeydown=function(e){if("Escape"==e.key)for(let e of modals)e.style.display="none"}</script><style>.pic_drop_green{padding-top:1em;padding-bottom:1em}.pic_drop_green details>summary{color:#fff;display:inline-block;width:auto;cursor:pointer;padding:0 6px;margin:0;border-width:1px;border-style:solid;box-shadow:3px 3px 4px #000;background-color:#3f6b4b}.pic_drop_green details[open]>summary{width:auto;padding:0 6px;border:#a8a8a8;border-width:1px;border-style:solid;color:#fff;background-color:#3f6b4b}.pic_drop_green details>p{display:block;width:auto;padding:0;margin:0}.multiple_pics{text-align:center}.multiple_pics h2{text-decoration:none;padding-bottom:0}.multiple_pics .row{display:flex}.multiple_pics .column2{flex:50%}.multiple_pics .column3{flex:33.33%}</style><script>function generateId(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"_")}function copyToClipboard(e){const t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}function showTooltip(e,t,n="Link Copied"){const o=document.createElement("div");o.style.position="absolute";const l=document.createElement("span");l.textContent=n,l.style.position="absolute",l.style.background="rgba(63, 99, 136, 0.75)",l.style.color="white",l.style.padding="4px 2px",l.style.borderRadius="4px",l.style.fontSize="14px",l.style.textAlign="center",l.style.fontWeight="700",o.appendChild(l),t.appendChild(o);const i=t.getBoundingClientRect(),c=e.clientX-i.left-28,d=e.clientY-i.bottom-25;l.style.top=`${d}px`,l.style.left=`${c}px`,setTimeout(()=>{t.removeChild(o)},1e3)}function handleH2Elements(){document.querySelectorAll("h2").forEach(e=>{e.addEventListener("click",function(t){const n=e.textContent.trim();copyToClipboard(`${window.location.origin}${window.location.pathname}#${generateId(n)}`),showTooltip(t,e)})})}function handleH4Elements(){document.querySelectorAll("h4").forEach(e=>{const t=`sub_${generateId(e.textContent.trim())}`;e.setAttribute("id",t);const n=document.createElement("a");n.href=`#${t}`,n.innerHTML=e.innerHTML,n.style.textDecoration="underline",e.innerHTML="",e.appendChild(n),n.addEventListener("click",function(t){copyToClipboard(n.href),showTooltip(t,e),t.preventDefault()})})}document.addEventListener("DOMContentLoaded",function(){handleH2Elements(),handleH4Elements()})</script><style>h2,h4{cursor:pointer}.hand-cursor{cursor:wait}h2:hover,h4:hover{color:rgba(0,0,0,.5)}</style><!-- 
#################################################
# FOR EACH SPECIFIC PAGE
#################################################
 --><nav class="nav"><button class="nav-toggle" aria-label="Toggle navigation"><img src="/julia_book/assets/icons/dropdown.png" style="width:auto;height:30px;opacity:.9;padding-bottom:2px;margin-left:0"> <span class="nav-title"><i>11g.</i> Multithreading Packages</span></button><div class="nav-menu"><ul><li><a href="#introduction" data-offset="-40">Introduction</a></li><li><a href="#package_ohmythreads" data-offset="-40">Package "OhMyThreads"</a></li><li><a href="#polyester_parallelization_for_small_objects" data-offset="-40">Polyester: Parallelization for Small Objects</a></li><li><a href="#simd_multithreading" data-offset="-40">SIMD + Multithreading</a></li><li><a href="#floops_parallel_for-loops_i_stylecolorredoptional" data-offset="-40">FLoops: Parallel For-Loops (<strong><i style="color:red">OPTIONAL</i></strong>)</a></li></ul></div></nav><script>const navToggle=document.querySelector(".nav-toggle"),navMenu=document.querySelector(".nav-menu"),navLinks=document.querySelectorAll(".nav-menu a");navToggle.addEventListener("click",()=>{navMenu.classList.toggle("show")}),navLinks.forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const t=document.querySelector(e.getAttribute("href")),o=parseInt(e.dataset.offset,10)||0;window.scrollTo({top:t.offsetTop+o,behavior:"smooth"})})}),document.addEventListener("click",e=>{navMenu.contains(e.target)||navToggle.contains(e.target)||navMenu.classList.remove("show")}),document.addEventListener("keydown",e=>{"Escape"===e.key&&navMenu.classList.remove("show"),"x"===e.key&&e.ctrlKey&&navMenu.classList.toggle("show")})</script><style>.nav{position:fixed;top:0;right:0;z-index:200;background-color:#3f6388;padding:0;display:block;font-family:Inter}.nav-toggle{background-color:#3f6388;border:none;padding:8px;padding-right:24px;font-size:18px;cursor:pointer}.nav-menu{position:fixed;right:0;top:48px;background-color:#3f6388;padding:10px;width:300px;height:100vh;overflow-y:auto;display:none}.nav-menu ul{list-style:none;margin:0;padding:0}.nav-menu li{margin-bottom:10px}.nav-menu a{color:#fff;text-decoration:none;font-size:18px;font-weight:700;text-align:center;padding:10px 10px;display:block}.nav-menu a:hover{color:#fff;background-color:#000}.nav-title{font-size:18px;margin-left:10px;color:#fff}.nav-brand{font-size:24px;font-weight:700;margin:10px 20px;color:#fff}.nav-menu.show{display:block}</style><script src="/julia_book/libs/clipboard.min.js"></script><script>!function(){for(var t=document.getElementsByTagName("pre"),e=0;e<t.length;e++){var n=t[e].children[0].className;if(n.startsWith("language-")||n.endsWith(" hljs")){var o=document.createElement("button");o.className="copy-button",o.textContent="Copy",t[e].appendChild(o)}}var r=new Clipboard(".copy-button",{target:function(t){return t.previousElementSibling}});r.on("success",function(t){t.clearSelection(),t.trigger.textContent="copied!",window.setTimeout(function(){t.trigger.textContent="copy"},2e3)}),r.on("error",function(t){t.trigger.textContent='Press "Ctrl + C" to copy',window.setTimeout(function(){t.trigger.textContent="Copy"},5e3)})}()</script><style>@media print{.franklin-content{box-sizing:border-box}.jumbotron{padding-right:60px!important}.jumbotron,.name_format,.phd_format{color:#000!important}.name_format a{color:#3f6388}.hide_tab details[open] p,.hide_tab>details[open]>summary,.sign_output,.tab_code_links,nav{display:none!important}.bar_top,.bar_top .modalButton,.copy-button,.footn,.left_bar,.left_bar_mobile,.nav-item,.navbar,footer,nav{display:none!important}.tab_wrapper{display:flex!important;flex-wrap:wrap;gap:1cm;width:100%;padding-top:20px;padding-bottom:20px}.tabcontent{display:block!important;margin-bottom:2em;page-break-inside:avoid;border:2px solid #3f6388!important}.print-tab-title{font-weight:700;font-size:100%;padding:0 0;padding-left:.35cm;color:#000;text-transform:uppercase;display:block!important}.code_in_modal,.output_in_modal{width:100%;height:auto!important;overflow:visible;border:none!important}.code_NoFormat pre,.mixed_output_NoFormat pre{border:none!important}.code_NoFormat,.code_in_modal,.julia_repl_NoFormat,.mixed_output_NoFormat,.mixed_output_inline{margin:0!important;padding:0!important}.code_NoFormat,.julia_repl_NoFormat,.mixed_output_NoFormat{padding-left:.35cm!important;padding-top:.15cm!important}.output_in_modal{margin-top:12px!important;border-top:2px solid #20c679!important}.code_NoFormat,.code_in_modal{border-top:2px solid #3f6388}#remarkCodeContent{height:.1px!important;visibility:hidden!important}}</style><script>function printAllTabs(){const t=document.querySelectorAll(".tablink");document.querySelectorAll(".tabcontent").forEach((e,n)=>{const r=t[n].textContent.trim();if(!e.querySelector(".print-tab-title")){const t=document.createElement("div");t.className="print-tab-title",t.textContent=r,e.insertBefore(t,e.firstChild)}});for(var e=document.getElementsByTagName("a"),n=0;n<e.length;n++)e[n].removeAttribute("href"),e[n].style.textDecoration="none"}window.matchMedia("print").addListener(t=>{if(t.matches)printAllTabs();else{document.querySelectorAll(".tabcontent").forEach(t=>{const e=t.querySelector(".print-tab-title");e&&t.removeChild(e)})}})</script>