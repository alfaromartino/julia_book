
<!-- 
#################################################
# HEAD - FOR ALL PAGES
#################################################
 -->

<!doctype html>
<html lang="en">
<head>  
    
  <!-- META -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Martin Alfaro">
  

  <!-- FRANKLIN DEFINED - LATEX AND CODE HIGHLIGHTS -->
   <!-- HERE WE ADD ANY CSS ELEMENT WE WANT TO ADD
(don't confuse head with header, head applies globally) -->

<link rel="stylesheet" href="/julia_book/libs/katex/katex.min.css">

<!-- FOR LATEX -->
<!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css"></link> -->

<!-- <link rel="stylesheet" 
href="https://fonts.googleapis.com/css?family=Open+Sans"></link> -->
<!-- Montserrat|Roboto|Lato|Raleway|Work+Sans|Raleway -->     
   <link rel="stylesheet" href="/julia_book/libs/highlight/styles/vs_myversion.css">
   

  <link rel="stylesheet" href="/julia_book/css/bootstrap.min.css">
  <style>
.section-bg-color {
  background-color: rgba(63, 99, 136, 0.07);
}

footer a {
  color: cornflowerblue;
}



  header {
    margin-top: 0px !important;
  }



header .jumbotron {
  background-image: linear-gradient(to right, black, rgb(0, 0, 0) 10%, rgb(63,99,136) 55%, rgb(63,99,136));;
  background-repeat: no-repeat;  
  background-size: 100%;  
}
</style>
  <link rel="stylesheet" href="/julia_book/css/custom.css">

    
<!-- WINDOWS TAB -->
  <title>11f. Applying Parallelization - Julia Book - Martin Alfaro</title>
  <link rel="icon" type="image/png"  href="/julia_book/assets/icons/favicon.ico">

<!-- for LUNR -->
  <script src="/julia_book/libs/lunr/lunr.min.js"></script>
  <script src="/julia_book/libs/lunr/lunr_index.js"></script>
  <script src="/julia_book/libs/lunr/lunrclient.min.js"></script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K96JNP7PKB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K96JNP7PKB');
</script>
<!-- end of google tag -->



<body id="page-top">
  <!-- HERE WE ADD ALL THE HTML ELEMENTS (PAGES) WE WANT TO ADD TO THE SITE, FOR INSTANCE THE SIDEBAR -->



<!-- 
#################################################
# FOR EACH SPECIFIC PAGE
#################################################
 -->
 
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Poppins|Crimson+Text|Cardo|Ubuntu"></link> -->
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"></link> -->
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter"></link> -->

<!-- 
<style>
     @font-face {
          font-family: 'Open Sans';
          src:
               /* url('/{{prepath}}/libs/fonts/OpenSans/OpenSans-Regular.ttf'), */
               url('../../libs/fonts/OpenSans/OpenSans-VariableFont_wdth,wght.ttf'),
               url('../../libs/fonts/OpenSans/OpenSans-Italic-VariableFont_wdth,wght.ttf');
          font-variation-settings: 'wght' 100 1000, 'wdth' 25 100;
     }

     @font-face {
          font-family: 'Inter';
          src:
               /* url('/libs/fonts/Inter/Inter-Regular.ttf'); */
               url('../../libs/fonts/Inter/Inter-VariableFont_slnt,wght.ttf'),
               /* font-variation-settings: 'wght' 100 1000, 'wdth' 25 100; */
     }
</style> -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+SC:wght@300;400;500;600;700&family=Inter:wght@100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    
 

 


 
<!-- format -->
 
<style>

/* THIS CONTROLS THE GLOBAL BEHAVIOR OF THE PAGE */
html { scroll-behavior: auto; }


/* change font size */
.jumbotron, .bar_top, .navbar, .nav-item, footer, .left_bar {
  font-size: 16px;  
  font-family: "Open Sans";
} 

.franklin-content{
  font-size: 17px;
  font-family: "Open Sans";
}


h1  {font-family: "Inter", "Open Sans" ; font-weight:600;}

/* TITLE AND NAME */
h1{
  padding-top: 0.1em;
  font-size  : 210% !important;
  font-weight: bold;
  text-align : center;
}



.phd_format {  
  color: white;
    /* padding: -0.5em 1.0em; */
  text-decoration: none;
  font-size      : 90%;
  text-align     : center;
  margin-top     : -0.2em;
  margin-bottom  : -0.89em;
  }

  

  
  .name_format{    
  padding-top: 0.35em;
  /* padding-bottom: 0.3em; */
  text-decoration: none;
  font-size: 160%;
  }


  .name_format a { color: white; }
  .name_format a:hover {
    color: rgb(212, 212, 212);
    color: rgb(214, 227, 240)
  }




/* content */
.franklin-content{
  /* background-color:rgb(235, 235, 235);   */
  background-color: rgb(217, 224, 231);  
}



.franklin-content{  
  margin:0;
  width:100%;  
  height:100%;    
  justify-content:center;       
  text-align: justify;
  text-justify: inter-word;
  line-height: 1.65;  
  /* word-wrap: bh4ak-word; */
}


/* all header */
.jumbotron{          
  margin-bottom:0px;    
  padding-top: 42px;
  padding-bottom:2em;  
  border-bottom: #000000 solid 1px;   
  border-radius: 0;}
  
  
  .franklin-content, .jumbotron {
      padding-left: 160px;}




  footer{        
        background-image: linear-gradient(to right, rgba(35,55,75,255), rgba(0, 0, 0, 1) 50%,  rgb(63,99,136));
        background-color:rgb(63,99,136);
        width: calc(100%+10px);       
        margin-left: -10px;
        padding-left: 10px;
    }

/* @media screen and (min-width: 992px) {
  html {  
    zoom: 100%;
    width:100%;
  }
} */


/* .jumbotron.jumbotron-fluid.container-fluid.bg-primary{
  background-image: url(/assets/WallpaperDog-17291225.jpg);
  background-size: cover;  
} */

/* FOR THE BODY - this changes its position*/
/* .franklin-content {   
  position:absolute;
  margin-left: 0px; 
  padding-top:0;}  */


/* ALL 
.franklin-content,.jumbotron, .bar_top, .navbar, .nav-item {
  font-family: "Segoe UI"; FONT USED by DEFAULT  BY FRANKLIN 
} */

/* HEADER + NAME
  .jumbotron, h1{
  font-family: "Raleway"; 
  font-weight: 550;  
} */

/* ALL HEADER - title of page */
/* .jumbotron {
  text-align:left;
  padding-left:20px;
} */


/* HEADER only - title of page */
/* h1 {
  text-align:left;
} */

/* FORMAT OF THE TEXT IN THE MAIN BODY */
/* section .container{
  margin-left: auto;  
} */



h2 {
  text-transform : uppercase;
  font-size      : 160%;
  text-align     : center;
  text-decoration: underline;
  padding-bottom : 0.5em;
  /* color          : rgb(58, 108, 158); */
  font-weight    : 700
}

h3{
  text-align     : left;
  text-transform : uppercase;
  text-decoration: underline;  /*none; */
  padding-bottom : 0.0em;
  padding-top    : 0.5em;
  font-size      : 120%;
  font-weight    : 600;
  /* color:rgb(49, 77, 105); */
}

h4 a {
  font-weight    : 800 !important;
}

h4 {
  text-align     : left;
  color          : rgb(58, 108, 158);
  text-decoration: underline;          /*none; */
  padding-bottom : 0.0em;
  padding-top    : 0.5em;
  font-weight    : 800 !important;
  text-transform : uppercase;
  font-size      : 120%;
}




h5,h6{
  text-indent   : 0;
  line-height   : 1.2em;
  padding-top   : 0.99em;
  padding-bottom: -0.0em;
}

section {
  margin-left:0;  
  /* font-family: "Open Sans"; */  
  padding-left  : 1%;
  padding-right : 1%;
  padding-top   : 1.5%;
  padding-bottom: 1.0%;
  text-align    : justify;
  text-justify  : inter-word;
  line-height   : 1.65;
  /* text-indent: 2.5%; */
  text-indent: 0;
  font-size: 100%;
  color: black;       
}

/* section p {  margin-bottom:24px;} */




section h1 { /* this is for the title defined as latex*/
  text-indent:0;
  margin-left:0px;  
}
  
section h2 {  
  text-indent: 0%; /* space between title and text  */
  margin-bottom: 0em; /* space between title and text  */  
} 


.franklin-content ul { 
  margin-left: 0em;
  margin-top: -0.6em;
  line-height: 1.15;}

.franklin-content ul li p { 
  margin-left: 0em;
  margin-bottom: 0.6em;
  line-height: 1.35;
  text-indent:0;}

.franklin-content ol li { 
    margin-left: 2em;
    line-height: 1.15;}

ul ::marker {  
  color: rgb(73, 115, 157); 
}

ol ::marker {
    color: rgb(83, 129, 175);
    font-weight: bold;
}

a.anchor {
    display: block;
    position: relative;
    top: -150px;    
    visibility: hidden;    
}

section a {  
  color: rgb(62, 121, 180);
  text-decoration: underline;  
  font-weight: 500;
}

section a:hover{
  color: rgba(62, 121, 180, 0.699);
  text-decoration: underline;  
}


</style>



<!-- FOR OFFSETTING LINKS -->
<style>
 
  :target {
    scroll-margin-top: 40px; 
  }
  
  .own-anchors a{
  scroll-margin-top: 4em;
  }

</style> 
 <!-- <div class="left_bar" style="color:white;">
    <div style="float:center; align-items:center; justify-content: center; height:160px; width:calc(90px * 1.55165);">
        <img src="/julia_book/assets/pics_html/julia_logo-dark.svg"
        style= "position:relative; width:90%; height:auto; padding-top:45px;  padding-left:10px;">     
    </div> -->

<div class="left_bar" style="color:white;">
  <span>
    <img src="/julia_book/assets/pics_html/julia_logo-dark.svg" alt="pic" style="padding: 12px; padding-right:28px;padding-top:44px"
      width="160px" height=auto>
  </span>



  <!-- FOR TITLE BELOW THE PICTURE  -->
  <!-- <div style="color: rgb(63,99,136);
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      text-shadow: 1px 1px 0px #fff, -1px -1px 0px #fff, 1px -1px 0px #fff, -1px 1px 0px #fff, 0px 0px 5px  #fff;">
      CONTENT
    </div> -->



  <ul>
    <li style="text-transform: uppercase">
      <a href="/julia_book/index.html"><img src="/julia_book/assets/icons/home.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Home
      </a>
    </li>

    <li style="text-transform: uppercase">
      <a href="/julia_book/list_posts/"><img src="/julia_book/assets/icons/books03.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Chapters
      </a>
    </li>
    <li>      
      <div style="text-indent:0;">
        <button class="modalButton" style="text-transform: uppercase">
          <img src="/julia_book/assets/icons/keyboard01.png" style="width:20%; height:auto; opacity:0.9;margin-bottom:-26px; margin-left:-30px; padding-right:4px;">
          <span style="margin-left:-0.2em;">Notation &<div style="margin-left:-1.2em; margin-top:-3em;">Hotkeys</div></span>
        </button>                   
      <div class="kbd_shortcuts">
    <div class="modal" id="kbdmodal_bar">
        <!-- Modal content -->
        <div class="modal-content" >
            <div class="modal-header">
                <h2> NOTATION</h2>
            </div>
            <div class="modal-body" style="height:auto;">
                Generic expressions are represented by <b>&lt;something&gt;</b> (e.g., <code>&lt;function&gt;</code> or <code> &lt;operator&gt;</code>). 
                This is just notation, and the symbols <code>&lt;</code> and <code>&gt;</code> should not be misconstrued as Julia's syntax.
            </div>
            <div class="modal-header">
                <h2> PAGE LAYOUT </h2>
            </div>
                <div class="modal-body">
                    If you want to adjust the size of the font, <b>zoom in or out on pages</b> by respectively using <kbd>Ctrl</kbd>+<kbd>+</kbd> and <kbd>Ctrl</kbd>+<kbd>-</kbd>. The layout will adjust automatically. <br>
                <span class="brmine"></span>
            </div>
            <div class="modal-header">
                <h2> LINKS TO SECTIONS </h2>
            </div>
                <div class="modal-body">
                    To quickly share a link to a specific section, simply hover over the title and click on it. The link will be automatically copied to your clipboard, ready to be pasted.
                <span class="brmine"></span>
            </div>
            <div class="modal-header">
                <h2> KEYBOARD SHORTCUTS</h2>
            </div>
            <div class="modal-body">
                <style type="text/css">
                    .tg {
                        border-collapse: collapse;
                        border-spacing: 0;
                    }

                    .tg td {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        overflow: hidden;
                        padding: 10px 12px;
                        word-break: normal;
                    }

                    .tg th {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        font-weight: normal;
                        overflow: hidden;
                        padding: 10px 5px;
                        word-break: normal;
                    }

                    .tg .tg-80zn {
                        background-color: rgba(63, 99, 136, 0.2);
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: center;
                        vertical-align: top
                    }

                    .tg .tg-esg4 {
                        background-color: #ebebeb;
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: right;
                        vertical-align: top
                    }

                    .tg .tg-8jgo {
                        border-color: #ffffff;
                        text-align: left;
                        vertical-align: top
                    }

                    .tg .tg-ofj5 {
                        border-color: #ffffff;
                        text-align: center;
                        vertical-align: top
                    }
                </style>

                <table class="tg" style="margin-left: auto;  margin-right: auto;">
                    <thead>
                        <tr>
                            <th class="tg-80zn">Action</th>
                            <th class="tg-80zn">Keyboard Shortcut</th>
                        </tr>
                    </thead>
                    <tbody>                        
                        <tr>
                            <td class="tg-8jgo">Previous Section</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠘</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Next Section</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠚</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">List of Sections</td>
                            <td class="tg-ofj5"><kbd>Ctrl + z</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">List of Subsections</td>
                            <td class="tg-ofj5"><kbd>Ctrl + x</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Close Any Popped Up Window (like this one)</td>
                            <td class="tg-ofj5"><kbd>Esc</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Open All Codes and Outputs in a Post</td>
                            <td class="tg-ofj5"><kbd>Alt + 🠛</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Close All Codes and Outputs in a Post</td>
                            <td class="tg-ofj5"><kbd>Alt + 🠙</kbd></td>
                        </tr>                                          
                    </tbody>
                </table>
                <span class="brmine"></span>
            </div>

            <div class="modal-header">
                <h2> TIME MEASUREMENT</h2>
            </div>
            <div class="modal-body">
                When benchmarking, the equivalence of time measures is as follows.
                <br>
                <br>
            
            
                <style type="text/css">
                    .tg {
                        border-collapse: collapse;
                        border-spacing: 0;
                    }
            
                    .tg td {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        overflow: hidden;
                        padding: 10px 5px;
                        word-break: normal;
                    }
            
                    .tg th {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        font-weight: normal;
                        overflow: hidden;
                        padding: 10px 5px;
                        word-break: normal;
                    }
            
                    .tg .tg-80zn {
                        background-color: #ebebeb;
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: left;
                        vertical-align: top
                    }
            
                    .tg .tg-esg4 {
                        background-color: #ebebeb;
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: right;
                        vertical-align: top
                    }
            
                    .tg .tg-8jgo {
                        border-color: #ffffff;
                        text-align: left;
                        vertical-align: top
                    }
            
                    .tg .tg-ofj5 {
                        border-color: #ffffff;
                        text-align: center;
                        vertical-align: top
                    }
                </style>
            
                <table class="tg" style="margin-left: auto;  margin-right: auto;">
                    <thead>
                        <tr>
                            <th class="tg-80zn">Unit </th>
                            <th class="tg-80zn">Acronym</th>
                            <th class="tg-80zn">Measure in Seconds</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="tg-8jgo">Seconds</td>
                            <td class="tg-ofj5">s</td>
                            <td class="tg-ofj5">1</td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Milliseconds</td>
                            <td class="tg-ofj5">ms</td>
                            <td class="tg-ofj5">10<sup>-3</sup></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Microseconds</td>
                            <td class="tg-ofj5">μs</td>
                            <td class="tg-ofj5">10<sup>-6</sup></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Nanoseconds</td>
                            <td class="tg-ofj5">ns</td>
                            <td class="tg-ofj5">10<sup>-9</sup></td>
                        </tr>
                    </tbody>
                </table>
            
            </div>
            </div>



    <style>        
        .left_bar .kbd_shortcuts {
            color          : black;
            font-size      : 16px;
            line-height    : 1.55;
            list-style-type: none;
            position       : relative;
        }

        .left_bar .kbd_shortcuts kbd {
            font-size: 14px;}


        /* bar topright modal (for content of the modal) */
        .left_bar .kbd_shortcuts .modal-content {
            position        : relative;
            width           : 1200px;
            max-width       : 90%;
            height          : max-content;
            max-height      : 90%;
            margin-top      : 55px;
            background-color: rgb(207, 218, 228);  /* rgb(235, 235, 235); */
            overflow        : auto;
        }

        .left_bar .kbd_shortcuts .modal-body {
            margin        : 0;
            padding-bottom: 12px;
            text-align    : justify;
            
            padding-top   : 8px;
            padding-bottom: 2px;
            overflow      : visible;
            height        : 100%;
            
        }

        .left_bar .kbd_shortcuts .modal-header {
            padding: 0;
            color  : white;
            width  : 100%;
        }

        .left_bar .kbd_shortcuts .modal-header h2 {
            padding-top     : 8px;
            font-size       : 20px;
            font-weight     : bold;
            width           : 100%;
            text-align      : center;
            color           : white;
            background-color: rgb(63,99,136)
        };            
        

        

        .left_bar .kbd_shortcuts .modal-body p {
            padding     : 0px 4px;
            text-align  : justify;
            text-justify: inter-word;
        }


        /* modal button */
        .left_bar .modalButton {
            border          : none;
            box-shadow      : none;
            width           : auto;
            padding         : 0;
            background-color: transparent;
            color           : white;
            margin          : 0;
        }

        .left_bar .brmine {
            display      : block;
            margin-bottom: 0.5em;
        }

    </style>


    </div> 
    </li>
    <li style="text-transform: uppercase">
      <a href="/julia_book/links/"><img src="/julia_book/assets/icons/links.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Links
      </a>
    </li>
    <li>
      <h3 style="font-weight:400; font-size: 14px; padding-top:4em; margin-bottom:-0.6em; text-decoration: none;">Dark Mode</h3>
        <label class="switch">
        <input type="checkbox" id="toggleStyles">
        <span class="slider round"></span>
      </label>
    </li>    
  </ul>
  

      
     <div class="searchForm">
      <form action="https://duckduckgo.com/" method="get" onsubmit="return prependSiteOperator();">
        <input type="text" id="searchInput" name="q" placeholder="Search..." required>
        <!-- <input type="submit" value="Search"> -->
      </form>    
    </div>
    
    
  <div class="personal_website">
    <a href="https://alfaromartino.github.io"><img src="/julia_book/assets/icons/personal.png"
        style="width:18%; height:auto;opacity:0.9;margin-bottom:-14px; padding-right:4px">
      Personal
      <!-- <div style="margin-left:calc(30px + 6px); margin-top:-0.5em;"> Website</div> -->
      <div style="margin-left:calc(30px + 2px); margin-top:-0.5em;"> Website</div>
    </a>
  </div>


  

  <!-- {{if add_github_star}}
<a class="github-button" href="https://github.com/{{github_repo}}" data-icon="octicon-star" data-size="large" 
data-show-count="true" aria-label="Star {{title}} on GitHub">Star</a>
{{end}}       -->
</div>




<style>

@media (max-width: 850px), (max-height: 600px){
  .left_bar{display:none}
}

.left_bar {
  z-index         : 200;
  background-image: linear-gradient(to left bottom, rgb(0, 0, 0), rgb(0, 0, 0) 10%, rgb(63, 99, 136) 80%, rgb(63, 99, 136));
  position        : fixed;
  font-family     : "Inter", "Open Sans" ;
  height          : 100%;
  top             : 0;
  left            : 0;
  font-size       : 20px;
  width           : 160px;
}



.left_bar ul{
  list-style-type: none;
  float          : left;
  font-size      : 80%;
  position       : relative;
  padding-left   : 0.8em;
  padding-top    : 40px;
  line-height    : 4.25em;  
}




.left_bar li a, .left_bar .personal_website a{
color: white;
}


.left_bar a:hover, .left_bar .personal_website a:hover{
  color: rgb(160, 159, 159);  
}


.left_bar .personal_website{
  position      : absolute;
  bottom        : 0;
  padding-bottom: 1em;
  left          : 12px;
  font-size     : 20px;
  font-family   : "Cormorant SC";
  font-weight   : bold;
}


</style>




<!-- FOR SEARCH BAR -->
<script>
      function prependSiteOperator() {
        var searchInput = document.getElementById('searchInput');
        // Prepend the site: operator to restrict the search to your domain.
        searchInput.value = 'site:https://alfaromartino.github.io/julia_book/ ' + searchInput.value;
        return true; // Continue with form submission.
      }
</script>

<style>
  .left_bar .searchForm {
    width       : 100%;  /* set a width for the container if needed */    
    }
  .left_bar .searchForm input[type="text"] {
      width           : 100%;
      box-sizing      : border-box;  /* ensures padding/border don’t push the width out */
      background-color: inherit;
      border          : 0px solid;
      border-color    : white;
      height          : 60px;
      color           : white;
      padding-left    : 0.6em;
      font-size: 85%;
    }
</style>  

 <!-- Dark Mode -->



<style>
  /* The switch - the box around the slider */
  .switch {
    position: relative;
    display : inline-block;
    width   : 30px;
    height  : 17px;
  }
  
  .switch input {
    display: none;
  }
  
  /* The slider */
  .slider {
    position        : absolute;
    cursor          : pointer;
    top             : 0;
    left            : 0;
    right           : 0;
    bottom          : 0;
    background-color: #ccc;
    transition      : .4s;
  }
  
  .slider:before {
    position        : absolute;
    content         : "";
    height          : 13px;
    width           : 13px;
    left            : 2px;
    bottom          : 2px;
    background-color: white;
    transition      : .4s;
  }
  
  input:checked + .slider {
    /* background-color: #132433; */
    background-color: #000000;
  }
  
  input:checked + .slider:before {
    transform: translateX(13px);
  }
  
  /* Rounded sliders */
  .slider.round {
    border-radius: 17px;
  }
  
  .slider.round:before {
    border-radius: 50%;
  }
  
  
  
    /* =============== */
  /* DARK MODE */
  /* =============== */
  html.dark-mode {background-color:rgb(3, 9, 17) !important;}
  
  
  html.dark-mode .franklin-content, html.dark-mode .modal-body{
      /* background-color: rgb(3, 13, 24) !important; */    
      background-color: rgb(3, 9, 17) !important;}
  html.dark-mode .franklin-content section, html.dark-mode .index_container, html.dark-mode .modal-content  {
      color: rgb(235, 244, 252) !important; }
  
  /* FOR LIST OF CHAPTERS */
      html.dark-mode .index_container,  html.dark-mode .index_container h1{
          background-color: rgb(3, 13, 24) !important;}
      
      html.dark-mode .index_container ul > li{
          color: rgb(235, 244, 252) !important;}
  
      html.dark-mode .index_container a {  
          color: rgb(88, 140, 192);
    }
  
    html.dark-mode .index_container a:hover, html.dark-mode section a:hover, html.dark-mode h2:hover{
      color          : rgb(190, 213, 236);
  }
  
  html.dark-mode .multiple_pics { background-color: rgb(75, 109, 146); }
  html.dark-mode .multiple_pics h2 { color: white !important; }
  html.dark-mode .warning, html.dark-mode .note { color: black; }
  
  
  
  html.dark-mode .code_box, html.dark-mode .code_in_modal, html.dark-mode .output_in_modal, html.dark-mode .img_output_in_modal { 
      border-width    : 1px;
      border-style    : solid;
      /* border-color    :rgba(192, 215, 235, 0.75)  */
      border-color    :rgba(0, 44, 82, 0.99)     }
  
  
      html.dark-mode .tab_wrapper .tab_code_links .tablink.active{    background-color:rgba(94, 140, 185, 0.95); }
      html.dark-mode .tab_wrapper .tab_code_links .tablink:hover{     background-color:rgba(94, 140, 185, 0.95); }    
    
      html.dark-mode nav .nav-toggle, html.dark-mode .bar_top, html.dark-mode .nav-menu.show {
          background-image: linear-gradient(to top, rgb(18, 32, 48), rgb(18, 32, 48) 60%)   !important;}
          html.dark-mode .bar_top .modal-body, html.dark-mode .bar_top .modal-header, html.dark-mode .bar_top .modal-content{
              background-image: linear-gradient(to top, rgb(18, 32, 48), rgb(18, 32, 48) 60%)   !important;            }
      html.dark-mode header .jumbotron {
          background-image: linear-gradient(to bottom, rgb(18, 32, 48), rgb(18, 32, 48) 50%) !important;}        
          html.dark-mode  .left_bar {         
          background-image: linear-gradient(to left bottom, rgb(18, 32, 48), rgb(18, 32, 48) 10%); }
      html.dark-mode  footer {
          background-image: linear-gradient(to right, rgb(18, 32, 48), rgb(0,0,0) 10%)   !important;
          border-top      : 1px solid rgba(0, 44, 82, 0.99)     ;
          background-color: rgba(63, 99, 136, 0.3);
          width           : calc(100%+10px);
          margin-left     : 0px;
          padding-left    : 10px;
      }
  
  
      /* bar topright modal (for content of the modal in notation and hotkeys) */
      html.dark-mode .left_bar .kbd_shortcuts .modal-content {
              background-color: black !important;            
          }
  
          
  
  </style>
  
  
  
  <script>
    document.getElementById('toggleStyles').addEventListener('change', function() {
    const root = document.documentElement; // Reference to <html>
    if (this.checked) {
      root.classList.add('dark-mode');       // Add class to <html>
      localStorage.setItem('darkMode', 'enabled');
    } else {
      root.classList.remove('dark-mode');    // Remove class from <html>
      localStorage.setItem('darkMode', 'disabled');
    }
  });
  
  window.addEventListener('load', function() {
    const root = document.documentElement;
    var darkMode = localStorage.getItem('darkMode');
    if (darkMode === 'enabled') {
      document.getElementById('toggleStyles').checked = true;
      root.classList.add('dark-mode');       // Add class to <html> on load
    }
  });
  
  </script>

  <!-- NOTE THAT FOR DARK MOBILE WE NEED TO CHECK `allPages_leftbar_mobile.html` -->
 
<!-- CONTENT PAGES -->

    <header class="text-white text-center">
  
    <div class="jumbotron jumbotron-fluid container-fluid bg-primary">
  


    <h1><i>11f.</i> Applying Parallelization</h1>    
    <div class="lead"> </div>
    
    
    <div class="name_format">
      <a href="https://alfaromartino.github.io/" target="_blank" rel="noopener noreferrer">Martin Alfaro</a>
      </div>
      <div class="phd_format">PhD in Economics</div>
    
    
    

    

    <!-- {{if add_github_star}}
      <a class="github-button" href="https://github.com/{{github_repo}}" data-icon="octicon-star" data-size="large" 
      data-show-count="true" aria-label="Star {{title}} on GitHub">Star</a>
    {{end}} -->
  </div>
</header>


    <link href="https://fonts.cdnfonts.com/css/cascadia-mono" rel="stylesheet">

<style>

/*  */


  /* ================================================================= 
                                CODE FORMAT  
  ================================================================= */ 
  /* output_box_copied is LEGACY, we should delete in NEW FILES!!!!!! */

 /* for overflowing code  */
/* .col-lg-.mx-auto{        
        overflow: auto !important;
         }    */


  /* USEFUL TO CHANGE THE MARGINS OF THE CODE*/
  pre {
    position: relative;  /* necessary for "copy" button */
    overflow: hidden;
  }

    /* FOR WARNING, REMARK, AND MODALS 
  .warning pre, .remark pre, .modal-body pre {
    margin-bottom: 1.2em;
  }    */
       
    /* FOR INLINE CODE, WRITTEN WITHIN THE TEXT*/
  code {  
    background-color: rgb(209, 217, 224);              /*rgb(199, 223, 236);*/
    color           : black;
    text-indent     : 0%;
    padding-top     : 0.1em;
    padding-bottom  : 0.1em;
    padding-left    : 0.3em;
    padding-right   : 0.3em;
    vertical-align  : 0.05em;
    border          : 1px solid rgb(0, 16, 41);
    overflow        : hidden;
  }

  .julia_repl_NoFormat code, .mixed_output_NoFormat code {  
    background-color: rgb(82, 120, 104);         /*rgb(199, 223, 236);*/
    color           : #DCDCDC;
    border          : 1px solid rgb(82, 120, 104);        
  }


  
  
  
  
    
  /* COPY BUTTON */
  /* version blue, conceived by use of code only */
   
  .copy-button {
    cursor          : pointer;
    border          : none;
    font-size       : 12px;
    text-transform  : lowercase;
    font-weight     : 500;
    padding         : 2px 10px 2px;
    /* background-color:   #3f6b4b; */
    background-color: rgb(63,99,136);
    position        : absolute;
    top             : 0px;
    right           : 12px;            /*Button shows in the right side of block*/
    text-align      : center;
    color           : #ffffff;
    margin-top      : 0;
    z-index         : 1;
  }
  
  .copy-button:hover{
    outline         : none;
    background-color: rgb(84, 131, 179);
  }
  .copy-button:focus {
    outline         : none;
    background-color: rgb(50, 78, 107);
  }
  
  


/* ================================================================= 
                      BASIC FORMAT FOR OUTPUTS
  ================================================================= */ 
/* format of `julia>` */

      .julia_line{
        color      : rgb(32, 198, 121) !important;
        font-weight: bold;
        display    : inline;
        font-size  : 100%;
      }

/* to fix disproportionate size in outputs */
      .julia_repl_NoFormat {
        font-size    : 87%;
      }

      .julia_repl_NoFormat .julia_line, .julia_repl_NoFormat code{
        font-size:100%
      }

      .mixed_output_NoFormat{ font-size    : 87%;}

      .mixed_output_NoFormat pre, .mixed_output_NoFormat .julia_line, .mixed_output_NoFormat code {
        font-size:100%
      }


/* to not collapse with the copy button and `pre` */
.akin_to_pre {
  white-space: pre-wrap;
  font-family: "Consolas", monospace;  
}

  /* NoFormat for julia repl - no margins or paddings, just colors, fonts, etc */
.julia_repl_NoFormat{  
    font-family     : "Consolas", monospace;
    color           : #DCDCDC;
    border          : none;
    background-color: rgb(1, 59,31);
    margin          : 0;
    padding         : 0;
}

.julia_repl_NoFormat .akin_to_pre{  
  line-height: 1.35;
  color      : #DCDCDC;
  margin     : 0;
  padding    : 0;
}




/* NoFormat for \output{} - no margins or paddings, just colors, fonts, etc  */
.franklin_output_NoFormat{
    font-family     : "Consolas", monospace;    
    margin          : 0;
    padding         : 0;
    background-color: rgb(1, 59,31);
  }

.franklin_output_NoFormat pre {  
    margin          : 0;
    padding         : 0;
    line-height     : 1.35;
    background-color: rgb(1, 59,31);
}

.franklin_output_NoFormat pre code{  
    margin          : 0 !important;
    padding         : 0 !important;
    border          : none;
    background-color: rgb(1, 59,31);
}

/* NoFormat for Mixed */



.mixed_output_NoFormat{  
    font-family     : "Consolas", monospace;
    color           : #DCDCDC;
    border          : none;
    background-color: rgb(1, 59,31);
    margin          : 0;
    padding         : 0;
}

.mixed_output_NoFormat pre{
  line-height: 1.35;
  color      : #DCDCDC;
  margin     : 0;
  padding    : 0;
}

.mixed_output_NoFormat pre code{
  margin          : 0 !important;
  padding         : 0 !important;
  border          : none;
  background-color: rgb(1, 59,31);
}



/* Inline for julia_repl and franklin_output - adding margins and paddings  */
.mixed_output_inline{
    color           : #DCDCDC;
    font-family     : "Consolas", monospace;
    background-color: rgb(1, 59,31);
    
    padding-left    : 1em;
    padding-top     : 0.5em;
    padding-bottom  : 1em;

    margin-top      : 0;
    margin-bottom   : 0;
  }

  

  /* ============================ 
        OUTPUT BOX for Tabs hidden
  ============================ */ 
          
  
  /* COLLAPSABLE OUTPUT BOX*/
  .output_box{
    margin : 0;
    padding: 0;
  }

  .output_box details > summary{  
    width           : max-content; max-width: 90%;
    padding-left    : 10px;
    padding-right   : 10px;
    background-color: #3f6b4b;
    cursor          : pointer;
    color           : #ffffff;
    box-shadow      : 3px 3px 4px black;
    text-indent     : 0;
  }
  
  .output_box details[open] > summary {
    width           : max-content; max-width: 90%;
    padding-left    : 10px;
    padding-right   : 10px;
    background-color: #3f6b4b;
    border          : #282c34;
    border-width    : 1px;
    border-style    : solid;
       
  }
  
  .output_box{
    padding-top   : 0.5em;
    padding-bottom: 1em;
    margin-top    : 0em;
    margin-bottom : 1em;
  } 
  
  

    
  
 /* ================================================================= 
                      BASIC FORMAT FOR OUTPUTS
  ================================================================= */ 
  

.code_NoFormat{    
    line-height     : 1.45;
    margin          : 0;
    padding         : 0;
    background-color: rgb(0, 16, 41);
  }

.code_NoFormat pre{       
    margin          : 0;
    padding         : 0;
    background-color: rgb(0, 16, 41);
}


.code_NoFormat pre code{          
    font-family     : "Cascadia Mono", monospace ;       /* Fira Mono */
    margin          : 0 !important;
    padding         : 0 !important;
    border          : none;
    background-color: rgb(0, 16, 41);
}

.code_NoFormat p{  
    padding: 0;
    margin : 0;
  }

.code_inline{  
    background-color: rgb(0, 16, 41);

    padding-left  : 1em;
    padding-top   : 0.5em;
    padding-bottom: 1em;
    
    margin-top   : 0;
    margin-bottom: 0;
  }


  
  
  /* ============================ 
          CODE BOX is for a TAB hidden 
  ============================ */ 

.code_box{
  margin : 0;
  padding: 0;  
}

.code_box details > summary{  
  width           : max-content;  max-width : 90%;
  padding-left    : 10px;
  padding-right   : 10px;
  background-color: rgb(63,99,136);
  cursor          : pointer;
  color           : #ffffff;
  box-shadow      : 3px 3px 4px black;
  text-indent     : 0;
}

.code_box details[open] > summary {
  width           : max-content; max-width: 90%;
  padding-left    : 10px;
  padding-right   : 10px;
  background-color: rgb(63,99,136);    
  border          : #282c34;
  border-width    : 1px;
  border-style    : solid;
     
}

.code_box{
  padding-top   : 0em;
  padding-bottom: 0em;
  margin-top    : 0em;
  margin-bottom : 1em;
} 
 



 /* ============================ */
/*          FOR MULTIPLE TABS MODALS     */
/* ============================ */
.hide_tab{
  padding-top   : 0em;
  padding-bottom: 0em;
  margin-top    : 0em;
  margin-bottom : 1em;
}

.hide_tab > details > summary {  
  max-width       : 100%;  min-width: 30px ;
  width           : fit-content;
  /* width           : auto; */
  padding-left    : 11px;
  padding-right   : 0px;
  padding-bottom  : 0px;
  background-color: rgb(63,99,136);
  cursor          : pointer;
  color           : #ffffff;
  text-indent     : 0;
  border          : #282c34;
  border-width    : 1px;
  border-style    : solid;
}
  .hide_tab > details[open] > summary .closed_text {
      display: none;
    }

    /* .hide_tab > details:not([open]) > summary  {      
      min-width: 25%;
    } */

    .hide_tab > details > summary .closed_text {    
    padding-left : 1em;
    padding-right: 1em;
    margin-left  : 0.25em;
    display      : inline-block;
    border-left  : #282c34;
    border-width : 1px;
    border-style : solid;
    border-bottom: none;
    border-top   : none;
    border-right : none;
    }        

.hide_tab > details[open] > summary {
  position        : absolute;
  width           : 35px; max-width: 90%;
  height          : 1.94em;
  padding-bottom  : 0px;
  padding-top     : 3px;
  padding-left    : 12px;
  padding-right   : 5px;
  background-color: rgb(63,99,136);
  border          : #282c34;
  border-width    : 1px;
  border-style    : solid;
  border-bottom   : none;
}




  
  /* ============================
      DEALING WITH TABS, FOR MODALS WITH ONLY OUTPUT OR ONLY CODE
  ============================*/

.tab_wrapper{
  width  : 100%;
  display: inline-block;    
  }


.tab_wrapper .tab_code_links{
  background-color: rgb(0, 16, 41);}


.tab_wrapper .tab_code_links .tablink{  
  background-color: rgb(63,99,136);
  color           : white;
  float           : left;
  border          : 1px solid black;
  outline         : none;
  cursor          : pointer;
  padding         : 2px 20px;  
  width           : max-content;
  height          : auto;
}

.tab_wrapper .tab_code_links .tablink.first_tab{ padding-left: 54px;}
.tab_wrapper .tab_code_links .tablink.active{    font-weight:500; background-color:rgba(82, 127, 173, 0.836);   }
.tab_wrapper .tab_code_links .tablink:hover{     background-color:rgba(82, 127, 173, 0.836); }

  
.tab_wrapper .tabcontent{    
  background-color: rgb(0, 16, 41);
  display         : none;
  width           : 100%;
  float           : left;
  margin          : 0;
  padding         : 0;
}

.tab_wrapper .tabcontent.active{  display: block;}




/* wrappers in modals */

.code_in_modal{  
  background-color: rgb(0, 16, 41);
  padding-left    : 1em;
  padding-top     : 0.5em;
  padding-bottom  : 1em;
  margin-top      : 0;
  margin-bottom   : 0;
}


  
.output_in_modal{  
    background-color: rgb(1, 59,31);    
  }



/* ============================
      ADDING IMAGES AS OUTPUTS
  ============================*/
/* COLLAPSIBLE OUTPUT WITH IMGS */
.img_output, .img_output_in_modal{
  text-indent     : 0;
  margin          : 0;
  padding         : 0;
  background-color: rgba(24,24,24,255);
}  

.img_output_old, .img_output_in_modal_old{
  text-indent     : 0;
  margin          : 0;
  padding         : 0;
  background-color: rgba(30,30,30,255);
}  



.sign_output{ 
  color           : white;
  width           : 100%; max-width: 100%;
  height          : auto;
  padding-bottom  : 0px;
  padding-top     : 0px;
  padding-left    : 12px;
  padding-right   : 12px;
  background-color: #3f6b4b;
  border          : #282c34;
  border-width    : 1px;
  border-style    : solid;
  margin-bottom   : 0px;
  padding-top     : 0em;
}

.outputmodal_container{   
  padding: 0;
  margin : 0;
}
</style>  







  <!-- ================================================================= 
   FOR GIFS IN OUTPUT MODALS 
   ================================================================= -->

<style>

.gif_output_in_modal{
      text-indent     : 0;
      margin          : 0;
      padding         : 0;
      background-color: rgba(24,24,24,255);                
  }  

.gif_output {
    position : relative;
    display  : inline-block;
    cursor   : pointer;
    margin   : 0;
    padding  : 0;
    max-width: 100%;
}

.gif-wrapper {
    display   : block;
    visibility: hidden;
    margin    : 0;
    padding   : 0;  
    max-width : 100%;  
}

.gif-wrapper.playing {
  visibility: visible; 
}

.play-overlay {
  position        : absolute;
  top             : 0;
  left            : 0;
  right           : 0;
  bottom          : 0;
  background-color: rgba(24,24,24,255);
  background-color: black;
  display         : flex;
  justify-content : center;
  align-items     : center;  
}

.play-overlay.hidden {
background: transparent;
}

.play-button {
  background: none;
  border    : none;
  color     : white;  
  cursor    : pointer;
  padding   : 0;
  transform : scale(0.5);
  transition: background 0.3s;
}

/* Hide pause button when playing */
.play-overlay.hidden .play-button {
  display: none;  
}


</style>




<!-- TO ADJUST THE HEIGHT OF GIFS
 IN THE CODE, WE SET ONE OF THE WIDTH, AND THE REST ADJUSTS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const gifWrappers = document.querySelectorAll('.gif_output');
    let loadedCount = 0;

    gifWrappers.forEach(wrapper => {
      const gif = wrapper.querySelector('.gif-wrapper');
      const overlay = wrapper.querySelector('.play-overlay');
      let isPlaying = false;

      // Wait for the GIF to load to get its proper dimensions
      gif.onload = function () {
        loadedCount++;
        if (loadedCount === gifWrappers.length) {
          // Call setMaxHeight after all GIFs have loaded
          setMaxHeight();
        }
      }

      wrapper.addEventListener('click', function () {
        if (!isPlaying) {
          // Play
          gif.classList.add('playing');
          overlay.classList.add('hidden');
          isPlaying = true;
        } else {
          // Stop
          gif.classList.remove('playing');
          overlay.classList.remove('hidden');
          isPlaying = false;
        }
      });
    });
  });

  function setMaxHeight() {
    // Get all elements with class gif-wrapper
    const gifWrappers = document.querySelectorAll('.gif-wrapper');

    // Initialize max height to 0
    let maxHeight = 0;

    // Iterate over each gif-wrapper to find the maximum height
    gifWrappers.forEach((wrapper) => {
      const height = wrapper.offsetHeight;
      if (height > maxHeight) {
        maxHeight = height;
      }
    });

    // Set the height of all gif-wrappers to the maximum height, maintaining aspect ratio
    gifWrappers.forEach((wrapper) => {
      wrapper.style.height = `${maxHeight}px`;
      wrapper.style.width = `auto`;
    });
  }






</script>
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  



  

  

  

  

  

  

  

  

  

  

  

  

  

<div class="bar_top">
  <ul>
     <li>
      <div style="text-indent:0;">
        <button class="modalButton" style="background-color: transparent; color:white; display:block;
              margin-bottom: -2px;">
          <img src="/julia_book/assets/icons/sheets01.png" style="width:auto; height:30px; opacity:0.9; padding-bottom:5px;margin-left:0px;">
            Sections</button>
      </div>      
      <!-- {{insert PAGES/content_keyboardShortcuts.html}} -->        
          <div class="modal" id="modal_bar">
  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <h2 style="text-decoration: none"> <span style="text-decoration: underline">PART II</span>: HIGH PERFORMANCE</h2>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="column">
          <div style="padding-bottom:0.8em"></div>
          <ul>
            <li>7. <u>Introduction to Performance</u>
              <ul>
                
                <li><a href="/julia_book/PAGES/07a_overview/"><i>a</i>. Overview and Goals</a></li><br>
                
                <li><a href="/julia_book/PAGES/07b_introPerformace/"><i>b</i>. When To Optimize Code?</a></li><br>
                
                <li><a href="/julia_book/PAGES/07c_benchmarks/"><i>c</i>. Benchmarking Execution Time</a></li><br>
                
                <li><a href="/julia_book/PAGES/07d_TS-onTypes/"><i>d</i>. Preliminaries on Types</a></li><br>
                
                <li><a href="/julia_book/PAGES/07e_TS-onFunctions/"><i>e</i>. Functions: Type Inference and Multiple Dispatch</a></li><br>
                
              </ul>
            </li>            
          </ul>
        </div>
        <div class="column">
          <div style="padding-bottom:0.8em"></div>
          <ul>
            <li>8. <u>Type Stability</u>
              <ul>
                
                <li><a href="/julia_book/PAGES/08a_overview/"><i>a</i>. Overview and Goals</a></li><br>
                
                <li><a href="/julia_book/PAGES/08b_TS-definition/"><i>b</i>. Defining Type Stability</a></li><br>
                
                <li><a href="/julia_book/PAGES/08c_TS-scalarsVectors/"><i>c</i>. Type Stability with Scalars and Vectors</a></li><br>
                
                <li><a href="/julia_book/PAGES/08d_TS-globalVariables/"><i>d</i>. Type Stability with Global Variables</a></li><br>
                
                <li><a href="/julia_book/PAGES/08e_TS-barrierFunctions/"><i>e</i>. Barrier Functions</a></li><br>
                
                <li><a href="/julia_book/PAGES/08f_TS-tuples/"><i>f</i>. Type Stability with Tuples</a></li><br>
                
                <li><a href="/julia_book/PAGES/08g_TS-highOrderFunctions/"><i>g</i>. Type Stability with Higher-Order Functions</a></li><br>
                
                <li><a href="/julia_book/PAGES/08h_TS-gotchas/"><i>h</i>. Gotchas for Type Stability</a></li><br>
                
              </ul>
            </li>            
          </ul>
        </div>
        <div class="column">
          <div style="padding-bottom:0.8em"></div>
          <ul>
            <li>9. <u>Reducing Memory Allocations</u>
              <ul>
                
                <li><a href="/julia_book/PAGES/09a_overview/"><i>a</i>. Overview and Goals</a></li><br>
                
                <li><a href="/julia_book/PAGES/09b_onAllocations/"><i>b</i>. Stack vs Heap</a></li><br>
                
                <li><a href="/julia_book/PAGES/09c_objectsAllocating/"><i>c</i>. Objects Allocating Memory</a></li><br>
                
                <li><a href="/julia_book/PAGES/09d_views/"><i>d</i>. Slice Views to Reduce Allocations</a></li><br>
                
                <li><a href="/julia_book/PAGES/09e_preallocations/"><i>e</i>. Pre-Allocations</a></li><br>
                
                <li><a href="/julia_book/PAGES/09f_reductions/"><i>f</i>. Reductions</a></li><br>
                
                <li><a href="/julia_book/PAGES/09g_staticVectors/"><i>g</i>. Static Vectors for Small Collections</a></li><br>
                
                <li><a href="/julia_book/PAGES/09h_lazyOperations/"><i>h</i>. Lazy Operations</a></li><br>
                
                <li><a href="/julia_book/PAGES/09i_lazyBroadcasting/"><i>i</i>. Lazy Broadcasting and Loop Fusion</a></li><br>
                
              </ul>
            </li>            
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="column">
          <div style="padding-bottom:0.8em"></div>
          <ul>
            <li>10. <u>Vectorization (SIMD)</u>
              <ul>
                
                <li><a href="/julia_book/PAGES/10a_overview/"><i>a</i>. Overview and Goals</a></li><br>
                
                <li><a href="/julia_book/PAGES/10b_macrosAlgorithms/"><i>b</i>. Macros as a Means for Optimizations</a></li><br>
                
                <li><a href="/julia_book/PAGES/10c_simd_intro/"><i>c</i>. Introduction to SIMD</a></li><br>
                
                <li><a href="/julia_book/PAGES/10d_simd_independence/"><i>d</i>. SIMD: Independence of Iterations</a></li><br>
                
                <li><a href="/julia_book/PAGES/10e_simd_unitStrides/"><i>e</i>. SIMD: Unit Strides</a></li><br>
                
                <li><a href="/julia_book/PAGES/10f_simd_branchless/"><i>f</i>. SIMD: Branchless Code</a></li><br>
                
                <li><a href="/julia_book/PAGES/10g_simd_LoopVectorization/"><i>g</i>. Packages For SIMD</a></li><br>
                
              </ul>
            </li>            
          </ul>
        </div>
        <div class="column">
          <div style="padding-bottom:0.8em"></div>
          <ul>
            <li>11. <u>Multithreading</u>
              <ul>
                
                <li><a href="/julia_book/PAGES/11a_overview/"><i>a</i>. Overview and Goals</a></li><br>
                
                <li><a href="/julia_book/PAGES/11b_multithread_intro/"><i>b</i>. Introduction to Multithreading</a></li><br>
                
                <li><a href="/julia_book/PAGES/11c_multithread_tasks/"><i>c</i>. Task-Based Parallelism: @spawn</a></li><br>
                
                <li><a href="/julia_book/PAGES/11d_multithread_safe/"><i>d</i>. Thread-Safe Operations</a></li><br>
                
                <li><a href="/julia_book/PAGES/11e_multithread_loops/"><i>e</i>. Parallel For-Loops: @threads</a></li><br>
                
                <li><a href="/julia_book/PAGES/11f_multithread_apply/"><i>f</i>. Applying Parallelization</a></li><br>
                
                <li><a href="/julia_book/PAGES/11g_multithread_packages/"><i>g</i>. Packages for Multithreading</a></li><br>
                
              </ul>
            </li>            
          </ul>
        </div>
        <div class="column">
          <div style="padding-bottom:0.8em"></div>          
        </div>
      </div>
    </div>
  </div>
</div>        
    </li>
  </ul>
</div>



  



<style>
  /* ================================================================= 
                        TOP BAR - TO NAVIGATE SECTIONS
  ================================================================= */ 
  .bar_top{padding-left:160px;}  
  
  .bar_top {  
    background-image: linear-gradient(to right, black, rgb(0, 0, 0) 10%, rgb(63,99,136) 55%, rgb(63,99,136));
    position        : fixed;                                                                                   /* fixed to stay at the top */
    width           : 100%;
    height          : 48px;
    top             : 0;
    left            : 0;
    padding         : 8px 0px 10px 0px;
    font-size       : 110%;
    z-index         : 125;
    font-family     : "Inter";
  } 
  
  .bar_top a:hover {
      color: rgb(160, 159, 159); 
  }
  
  
  .bar_top > ul {  
    list-style-type: none;
    float          : left;
    position       : relative;
    bottom         : 0;
    padding-left   : 1%;    
    left           : 160px;
  }
  
    .bar_top li a{   
    color: white;
  }

  
  
  .bar_top .modal{   
  background-color: transparent;
  /* left: 0; */
  /* top: 0; */
  margin-top  : 48px;
  padding-left: 1%;
  margin-left : 0;
  width       : 100%;
  height      : 100%;
  overflow    : auto;
  position    : fixed;
  
}  
  
  
  
  /* bar topright modal (for content of the modal) */
  .bar_top .modal-content {  
    position                  : relative;
    width                     : 1200px; max-width      : 90%;
    height                    : max-content; max-height: 90%;
    background-color          : black;
    margin                    : auto;
    padding                   : 8px;
    margin-left               : 160px;
    -webkit-animation-name    : none;
    /* -webkit-animation-duration: 0.0s; */
    animation-name            : none;
    /* animation-duration        : 0.0s; */
  }


  .bar_top .modal-header {  
    background-color: black;
    color           : white;
  }
  
   .bar_top .modal-body{    
    color:rgb(100, 157, 214);      
  }

  
  .bar_top .modal-body .row{display: flex;}    
  .bar_top .modal-body .row .column{flex:1;}  /* equal size of columns*/
  
  
  .bar_top .modal-body .row h3{ 
    padding-bottom:0.5em;}

    .bar_top .modal-body .row ul li{line-height: 1;}

  .bar_top .modal-body .row ul li ul { 
    list-style-type: none;
    margin         : 0;
    padding        : 0;
    padding-top    : 0.5em;
    padding-bottom : 0.4em;
    line-height    : 1;
  }

  .bar_top .modal-body .row ul li ul li {     
    line-height    : 1;
  }
  
  .bar_top .modal-body .row li {
    line-height    : 1;
    list-style-type: none;
    float          : center;
    text-indent    : -20px;
    padding-left   : 22px;
    position       : relative;
  }

  

.bar_top .modal-body .row .column {
  text-align: center; /* center align all contents in a column */
}

.bar_top .modal-body .row .column h3 {
  text-align: center; /* center align the h3 tag in a column */
}

.bar_top .modal-body .row .column ul {
  text-align         : left ;   /* left align the ul tag in a column */
  margin-left        : auto;    /* center the ul tag */
  margin-right       : auto;    /* center the ul tag */
  list-style-position: inside;  /* adjust the position of the list items */
  line-height        : 0.55em;
}
    

  /* modal button */
  .bar_top .modalButton {      
    border       : none;
    margin-bottom: 24px;
    box-shadow   : none;
    /* box-shadow: 3px 3px 4px black;   */
}

/* The Close Button */
.bar_top .modalClose {    
  font-size: 0px;   
}

    
    
  </style>
    
    <!-- <style>
	/* ================================================================= 
                      TOOLTIP - GENERAL APPROACH (NOT ONLY FOOTNOTES)
================================================================= */ 


.hovering_foot {
  position: relative;
  display: inline-block;
  margin-left:-3px;
  text-decoration: underline;
  text-decoration-style: double;
  text-decoration-color: rgb(85, 133, 182);  
}

.hovering_foot .h_foot_text {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;  
  
  /* Position the hovering_foot */
  position: absolute;
  z-index: 1;
  top: 100%;
  left: 50%;
  margin-left: -60px;
}

.hovering_foot:hover .h_foot_text {
  visibility: visible;
}




/* ================================================================= 
                      FOOTNOTES with TOOLTIP
================================================================= */ 


.supr {
  vertical-align: 80%;
  font-size: 75%;
  line-height: 1; 
}
.footn {
  position: relative;
  display: inline-block;
  margin-left:-0.6em;
  margin-right:0;
  color: #2669DD;
  text-decoration: underline;  
  }

.footn .footn_text {
  font-size: 125%;
  visibility: hidden;  
  width: max-content; max-width: 500px;
  text-align: justify;  
  text-justify: inter-word;
  text-indent: 0%;
  line-height: 1.5;
  background-color:#282c34;  
  color: #e0e4eb;
  border-radius: 6px;
  padding: 5px 12px 5px 12px;  
  
  /* Position the hovering_foot */
  position: absolute;
  z-index: 1;
  top: 100%;
  left: -125px;  
}

.footn:hover .footn_text {
  visibility: visible;
  
}

.footn a{
  color: #7b9fdd;
  }

.footn a:hover{
  color: #a1b6dbb2;
}


</style> -->



<style>

.footn {
	  position: relative;
	  display: inline-block;
	  margin-left: -0.6em;
	  margin-right: 0;
	  color: #2669DD;
	  text-decoration: underline;
	}

	.supr {
	  vertical-align: 80%;
	  font-size: 75%;
	  line-height: 1; 
	}
	
	
	
	.footn .footn_text {	
	  font-size: 125%;
	  visibility: hidden;  	  
	  text-align: justify;  
	  text-justify: inter-word;
	  text-indent: 0%;
	  line-height: 1.5;
	  background-color: #282c34;
	  color: #e0e4eb;
	  border-radius: 6px;
	  padding: 5px 12px 5px 12px;
	
	  /* Position the hovering_foot */
	  position: absolute;
	  z-index: 1;
	  bottom: 100%;	  
	  right:0;
	}
	
	.footn .footn_text.left {
		left:0;		
		width: max-content;
	  	max-width: 500px;
	}

	.footn .footn_text.right {	  
		right: 0;	  
		width: max-content;
	  max-width: 500px;
	}
	
	.footn:hover .footn_text {
	  visibility: visible;   
	}
	
	.footn a{
	  color: #7b9fdd;
	}
	
	.footn a:hover{
	  color: #a1b6dbb2;
	}
		
  </style>
  
  
  <!-- Include the jQuery library and add the script to handle the hover effect -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>

  
  <script>
$(document).ready(function() {
  $('.footn.supr').hover(
    function() {
      var footnoteText = $(this).find('.footn_text');
      var sentence = $(this).closest('p');
	  var sentenceWidth = sentence.width();
    //   var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
    //   var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

	  var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
      var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

     // Remove existing alignment classes
     footnoteText.removeClass('left right');

      // Add the appropriate alignment class
      if (isRightAligned) {
        footnoteText.addClass('right');
      } else {
        footnoteText.addClass('left');
      }

      // Add the "hovering" class to the footnote text
      footnoteText.addClass('hovering');
    },
    function() {
      // Remove the "hovering" class from the footnote text
      $(this).find('.footn_text').removeClass('hovering');
	  $(this).find('.footn_text').removeClass('left right');
    }
  );
});

  </script>



<!-- FOR MOBILE PHONES -->
<style>
	@media (max-width: 768px) {
		.footn .footn_text.left {
		left:0;		
		width: max-content;
	  	max-width: 200px;
	}

	.footn .footn_text.right {	  
		right: 0;	  
		width: max-content;
		max-width: 200px;
	}	}
</style>


<!-- <script>
	// Create a media query to match the condition (max-width: 768px)
	var mediaQuery = window.matchMedia('(max-width: 768px)');

	// Define a callback function to execute when the media query matches
	var mediaQueryHandler = function (event) {
		if (event.matches) {
			// Code to be executed when the media query matches (screen width <= 768px)
			$(document).ready(function () {
				$('.footn.supr').hover(
					function () {
						var footnoteText = $(this).find('.footn_text');
						var sentence = $(this).closest('p');
						var sentenceWidth = sentence.width();
						var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
						var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

						// Remove existing alignment classes
						footnoteText.removeClass('left right');

						// Add the appropriate alignment class
						if (isRightAligned) {
							footnoteText.addClass('right');
						} else {
							footnoteText.addClass('left');
						}

						// Add the "hovering" class to the footnote text
						footnoteText.addClass('hovering');
					},
					function () {
						// Remove the "hovering" class from the footnote text
						$(this).find('.footn_text').removeClass('hovering');
					}
				);
			});
		}
	};

	// Add the event listener to the media query
	mediaQuery.addListener(mediaQueryHandler);

	// Call the handler once at the beginning to check the initial state
	mediaQueryHandler(mediaQuery);

</script> -->    








<!-- MOBILE -->
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Poppins|Crimson+Text|Cardo|Ubuntu"></link> -->

<style>




@media (max-width: 850px){
  
     .jumbotron{
        font-size:90% !important;}

       .franklin-content{
        font-size:100% !important;}

       .franklin-content{padding-left: 1%; padding-right:1%;}

       .franklin-content .container{max-width:100% !important;}

      .index_container,  .index_container section{font-size: 100%;}
      
      .index_container{
        padding-left:1%;
        padding-right:1%;              
      }

      .index_container ul li {padding-right: 5%; padding-left: 0}
      .index_container ul {padding-right: 0; padding-left: 5%;}

      
      .home_container section {font-size: 100%; line-height:1.55em;}
      .home_container ul li {padding-right: 1%; padding-left: 0;}
      .home_container ul {padding-right: 0; padding-left: 0%;}
      .home_container .row li {padding-left:0; padding-bottom:1.55em; margin-left:0;}
      .home_container .bullets_nomarker ul li p {line-height:1.55 !important;}

      
      /* for fixing overflowing code */
      .col-lg-.mx-auto{     
        /* white-space: pre-wrap;  */
        overflow: auto !important;
         }   
          
    
      .jumbotron {      
        padding-left: 60px !important;
        padding-right: 1% !important;
        padding-top: 0; margin-top:0;}

      
     
           

      .modal {padding: 2px !important;}

      .bullets ol, .itemNoSpace ol{padding: 4px; }
      .bullets ul li, .itemNoSpace ul li{padding-right: 5%; padding-left:0;margin-left:0;}
      .bullets ul li p, .itemNoSpace ul li p {line-height:1.65;}      
      
}



@media (max-height: 600px) {
     .jumbotron{
        font-size:90% !important;}

        .franklin-content{font-size:100% !important}
        .franklin-content .container{max-width:100% !important;}

      .index_container,  .index_container section{font-size: 100%;}
      .index_container ul li {padding-right: 5%; padding-left: 0}
      .index_container ul {padding-right: 0; padding-left: 5%;}      

      .index_container{
        padding-left:1%;
        padding-right:1%;              
      }



      /* for fixing overflowing code */
      .col-lg-.mx-auto{     
        /* white-space: pre-wrap;  */
        overflow: auto !important;
         }   
          
    
      .jumbotron {      
        padding-left: 60px !important;
        padding-right: 1% !important;
        padding-top: 0; margin-top:0;}

    
      
      .franklin-content{
       padding-left: 0 !important;}
     

      
      .modal {padding: 2px !important;}
      
      .bullets ol, .itemNoSpace ol{padding: 6px; }
      .bullets ul li, .itemNoSpace ul li{padding-right: 5%; padding-left:0;margin-left:0;}
      .bullets ul li p, .itemNoSpace ul li p {line-height:1.55;}
      
      .index_container ul li {padding-right: 5%; padding-left: 0}
      .index_container ul {padding-right: 0; padding-left: 5%;}

}


</style>
<!-- <div class="left_bar_mobile" style="color:white;">
    <div style="float:center; align-items:center; justify-content: center; height:160px; width:calc(90px * 1.55165);">
        <img src="/julia_book/assets/pics_html/julia_logo-dark.svg"
        style= "position:relative; width:90%; height:auto; padding-top:45px;  padding-left:10px;">     
    </div> -->




<div class="left_bar_mobile" style="color:white;">

  <!-- <span>
    <img src="/julia_book/assets/pics_html/julia_logo-dark.svg" alt="pic" style="padding: 12px; padding-right:28px;padding-top:36px"
      width="{{contentPages_topleft_space_mobile}}" height=auto>
  </span> -->

  <!-- FOR TITLE BELOW THE PICTURE  -->
  <!-- <div style="color: rgb(63,99,136);
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      text-shadow: 1px 1px 0px #fff, -1px -1px 0px #fff, 1px -1px 0px #fff, -1px 1px 0px #fff, 0px 0px 5px  #fff;">
      CONTENT
    </div> -->

  <ul>
    <li>
      <a href="/julia_book/index.html"><img src="/julia_book/assets/icons/home.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:0px;">
        HOME
      </a>
    </li>

    <li>
      <a href="/julia_book/list_posts/"><img src="/julia_book/assets/icons/books03.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:0px;">
        CHAPTERS
      </a>
    </li>
    <li>
      <div class="dark-mode-mobile">
        <label class="switch">
          <input type="checkbox" class="toggleMobile">
          <span class="slider round"></span>
        </label>
      </div>
    </li>
  </ul>

  


  

  <!-- {{if add_github_star}}
<a class="github-button" href="https://github.com/{{github_repo}}" data-icon="octicon-star" data-size="large" 
data-show-count="true" aria-label="Star {{title}} on GitHub">Star</a>
{{end}}       -->
</div>




<style>

@media (min-width: 850px), (min-height: 600px){
  .left_bar_mobile{display:none}
}

@media (max-width: 850px), (max-height: 600px){
  .left_bar_mobile{display:block}
  

.left_bar_mobile img{display:none;}

.left_bar_mobile {
  z-index         : 200;
  background-image: none;
  position        : absolute;
  font-family     : "Inter";
  /* height          : auto; */
  height          : 160px !important;  
  top             : 0;
  left            : 0;
  font-size       : 85%
  width           : 60px;
}

    


.left_bar_mobile ul {
        list-style-type: none;
        float          : left;
        font-size      : 100%;
        position       : relative;
        padding-left   : 0.4em;
        padding-top    : 0.2em;
        line-height    : 2.0em !important;
        height         : 100%;
        top            : 0;
        width          : 60px;
        display        : flex;
        flex-direction : column;
        justify-content: space-around;
        }

    .left_bar_mobile li {
        flex: 1; 
    }

    
/* .left_bar_mobile ul {padding-left:0 !important; margin-left:0}   */
      /* .left_bar_mobile ul, .left_bar_mobile ul li {margin-bottom:-0.5em !important; text-indent:0; padding-top:0.0em !important; padding-bottom:0.0em !important; height:auto;} */
      

.left_bar_mobile li a{
color: white;
}


.left_bar_mobile a:hover{
  color: rgb(160, 159, 159);  
}


 

    .dark-mode-mobile{
        position  : relative;
        bottom    : 0;
        margin-top: auto;      /* add this */
    }    
    .dark-mode-mobile .switch{
        width   : 40px;
        height  : 20px;
    }
    .dark-mode-mobile .slider:before {  
        height          : 15px;
        width           : 15px;  
        }
   .dark-mode-mobile input:checked + .slider:before {
        transform: translateX(20px);
}





@media (max-width: 850px) {
          
      /* .left_bar_mobile ul {padding-left:0 !important; margin-left:0}   */
      /* .left_bar_mobile ul, .left_bar_mobile ul li {margin-bottom:-0.5em !important; text-indent:0; padding-top:0.0em !important; padding-bottom:0.0em !important; height:auto;} */
      /* .left_bar_mobile ul li a {width:60px !important;}   */
      /* .left_bar_mobile img{width:0% !important; height:0% !important; visibility: hidden;}   */
      
          
}


@media (max-height: 600px) {
    
        /* .left_bar_mobile ul {padding-left:0 !important; margin-left:0}   */
    /* .left_bar_mobile ul, .left_bar_mobile ul li {text-indent:0; padding-top:0em ; padding-bottom:0em !important; height:2.5em; font-size:100%;} */
            /* .left_bar_mobile ul li a {width:60px !important;}   */
      /* .left_bar_mobile img{display:none;}   */
}

@media (max-width: 850px), (max-height: 600px) {
      h2 {font-size: 140%;padding-top:1em; }      
      h1 {font-size: 180%;padding-top:0.5em ;padding-bottom:0em;}      
        }

              

      
    }

@media (max-height: 600px){
          /* .left_bar_mobile ul, .left_bar_mobile ul li {text-indent:0; padding-top:0.0em ; padding-bottom:0em !important; height:3.2em; font-size:105%;} */
        }

@media (max-width: 850px){
      /* .left_bar_mobile ul, .left_bar_mobile ul li {text-indent:0; padding-top:0.5em ; padding-bottom:0em !important; height:3.5em; font-size:102%; padding-left:0.15em;} */
    }  


</style>



<style>
  @media (max-width: 850px), (max-height: 600px){
  .lead {display:none}
  .bar_top, nav, .copy-button, .py-1 .container .center-text{
      display:none !important;}
      .jumbotron {
        /* padding-left: 60px !important;         */
        padding-left:80px;
        padding-right: 0.1% !important;
        padding-top: 0; margin-top:0;}
      }
</style>



<style>
  @media (min-width: 850px), (min-height: 600px){
.dark-mode-mobile {visibility:hidden}
}

@media (max-width: 850px), (max-height: 600px){
.dark-mode-mobile {visibility:visible}
}  
</style>

<script>
  document.querySelector('.toggleMobile').addEventListener('change', function () {
    const root = document.documentElement; // Reference to <html>
    if (this.checked) {
      root.classList.add('dark-mode');
      localStorage.setItem('darkMode', 'enabled');
    } else {
      root.classList.remove('dark-mode');
      localStorage.setItem('darkMode', 'disabled');
    }
  });

  window.addEventListener('load', function () {
    const root = document.documentElement; // Reference to <html>
    var darkMode = localStorage.getItem('darkMode');

    if (darkMode === 'enabled') {
      document.querySelector('.toggleMobile').checked = true;
      root.classList.add('dark-mode');
    } else {
      document.querySelector('.toggleMobile').checked = false;
    }
  });

</script>



<!-- {{ispage list_posts links}}  
  {{insert /index_page/lists_header.html}}  
  {{insert /index_page/lists_FORMAT.html}}  
{{end}} -->

<div class="franklin-content">
<section id="introduction" class="scrollspy section-bg-color">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Introduction</h2></p>
<p>So far, we&#39;ve explored two approaches for parallelizing code, tailored to different scenarios. The first one was <code>@spawn</code>. By allowing us to define the specific tasks to be processed, this provides granular control over the parallelization process. For its part, <code>@threads</code> represents a simplified approach to parallelizing for-loops, where the tasks spawned are automatically handled. In particular, they&#39;re defined based on the number of available threads. </p>
<p>Additionally, we&#39;ve pointed out that, due to inherent dependencies between computations, not all tasks lend themselves equally to parallelization. Specifically, when tasks aren&#39;t embarrassingly parallel, a naive approach can lead to severe issues like race conditions.</p>
<p>All this implies that, to this point, our discussion has been exclusively focused on the syntax and work distribution of these approaches. Therefore, we have yet to address how to apply multithreading in real scenarios, including strategies to deal with dependencies. </p>
<p>This section and the next one aim to bridge this gap, providing practical guidance on implementing multithreading. With this goal, we begin by showing the advantages of parallelizing at a coarse level compared to parallelization at individual operations. After this, we introduce a more general method based on <code>@spawn</code> to parallelize for-loops. This enables us to have control over the partition of iterations that define tasks. Its main advantage is the provision of a flexible distribution of iterations among tasks, thus giving us further control over task creation. The technique also makes it possible to apply multithreading under a ubiquitous type of dependency: reductions.</p>
<p>      </div>
    </div>
  </div>
</section>
<section id="better_to_parallelize_at_the_top" class="scrollspy">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Better To Parallelize at The Top</h2></p>
<p>Given the overhead involved in multithreading, there&#39;s an inherent trade off between creating new tasks and utilizing all our machine resources. Consequently, we must first carefully consider whether parallelizing our code is worthy. For instance, multithreading is only justified with collections if their sizes are substantial enough to make up for overhead involved. Otherwise, single-threaded approaches will consistently outperform parallelized ones.</p>
<p>In case multithreading is worthwhile, we immediately face another decision: at what level to parallelize code. In the following, we&#39;ll demonstrate that <strong>parallelism at the highest level possible is preferable to multithreading individual operations</strong>. The reason is that the former minimizes the overhead involved in creating tasks, thus resulting in faster execution times. </p>
<p>Note that the level of parallelization is limited by the degree of dependence between operations, explaining why we qualify the highest level as the one that&#39;s  <em>possible</em>. For instance, in problems requiring serial computation, the best we can achieve is a parallelization at each individual step.</p>
<p>To illustrate all this, let&#39;s consider a for-loop where each iteration needs to sequentially compute three operations. </p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Julia's Default </button>
    <button class="tablink" data-id=""> Parallelization at The Highest Level Possible </button>
    <button class="tablink" data-id=""> Each Operation Parallelized </button>    
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">step1&#40;a&#41; &#61; a ^ 2
step2&#40;a&#41; &#61; sqrt&#40;a&#41;
step3&#40;a&#41; &#61; log&#40;a &#43; 1&#41;

function all_steps&#40;a&#41; 
   y      &#61; step1&#40;a&#41;
   z      &#61; step2&#40;y&#41;
   output &#61; step3&#40;z&#41;

   return output
end

function foo&#40;x&#41;
   output &#61; similar&#40;x&#41;

   for i in eachindex&#40;output&#41;
      output&#91;i&#93; &#61; all_steps&#40;x&#91;i&#93;&#41;
   end

   return output
end

x_small  &#61; rand&#40;  1_000&#41;
x_large  &#61; rand&#40;100_000&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_small&#41;</code> <br/> <pre><code class="plaintext code-output">  4.923 μs (1 allocations: 7.938 KiB)
</code></pre> </div></p>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_large&#41;</code> <br/> <pre><code class="plaintext code-output">  507.797 μs (2 allocations: 781.297 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">step1&#40;a&#41; &#61; a ^ 2
step2&#40;a&#41; &#61; sqrt&#40;a&#41;
step3&#40;a&#41; &#61; log&#40;a &#43; 1&#41;

function all_steps&#40;a&#41; 
   y      &#61; step1&#40;a&#41;
   z      &#61; step2&#40;y&#41;
   output &#61; step3&#40;z&#41;

   return output
end

function foo&#40;x&#41;
   output &#61; similar&#40;x&#41;

   @threads for i in eachindex&#40;output&#41;
      output&#91;i&#93; &#61; all_steps&#40;x&#91;i&#93;&#41;
   end

   return output
end

x_small  &#61; rand&#40;  1_000&#41;
x_large  &#61; rand&#40;100_000&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_small&#41;</code> <br/> <pre><code class="plaintext code-output">  9.963 μs (122 allocations: 20.547 KiB)
</code></pre> </div></p>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_large&#41;</code> <br/> <pre><code class="plaintext code-output">  59.551 μs (123 allocations: 793.906 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">step1&#40;a&#41; &#61; a ^ 2
step2&#40;a&#41; &#61; sqrt&#40;a&#41;
step3&#40;a&#41; &#61; log&#40;a &#43; 1&#41;

function parallel_step&#40;f, x&#41;
   output &#61; similar&#40;x&#41;

   @threads for i in eachindex&#40;output&#41;      
      output&#91;i&#93; &#61; f&#40;x&#91;i&#93;&#41;
   end

   return output
end

function foo&#40;x&#41;
   y      &#61; parallel_step&#40;step1, x&#41;
   z      &#61; parallel_step&#40;step2, y&#41;
   output &#61; parallel_step&#40;step3, z&#41;
   
   return output
end

x_small  &#61; rand&#40;  1_000&#41;
x_large  &#61; rand&#40;100_000&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_small&#41;</code> <br/> <pre><code class="plaintext code-output">  35.938 μs (366 allocations: 61.641 KiB)
</code></pre> </div></p>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x_big&#41;</code> <br/> <pre><code class="plaintext code-output">  87.746 μs (369 allocations: 2.326 MiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>The example clearly illustrates that parallelization is only advantageous when dealing with big collections. This is evidenced by the execution times, where multithreading is only faster when <code>x_large</code> is considered. Secondly, an approach where tasks comprise all operations is faster than multithreading each in isolation. This is in part reflected in the reduced memory allocations when all operations are encompassed.</p>
 <h4> Implications </h4>
<p>The strategy of parallelizing code at the top level has significant implications for writing programs. This is especially the case when the code will eventually be applied to multiple objects. It suggests that we should start by writing code for a single object, without considering parallelization. Once the single-case code is thoroughly optimized, parallel execution can be seamlessly integrated at the highest level. The approach not only improves performance, but also simplifies the coding process by streamlining the debugging and testing of code. </p>
<p>A typical example where this strategy arises naturally is scientific simulations, where numerous independent runs of the same model are executed. In this case, the best strategy is to focus on a single-thread codebase for the model, subsequently processing the different runs of the model in parallel. </p>
<p>      </div>
    </div>
  </div>
</section>
<section id="the_importance_of_work_distribution" class="scrollspy section-bg-color">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>The Importance of Work Distribution</h2></p>
<p>Multithreading performance is influenced by the balance of computational workload across iterations. The <code>@threads</code> macro is highly effective when each iteration requires a roughly equal processing time. This is because the tasks spawned will comprise an equal amount of iterations. However, scenarios with varying computational effort can pose significant challenges. In those cases, some threads may remain idle, while others will be heavily loaded. This may dramatically reduce the potential performance gains of parallel processing.</p>
<p>To address this issue, we need to have more control about how to distribute work among threads. With the tools introduced so far, we could employ <code>@spawn</code> to make each iteration represent a different task. However, this approach becomes extremely inefficient if there is a substantial number of iterations. The reason is that defining many more tasks than the number of threads available results in an unnecessary substantial overhead. The following example reveals this feature, where the execution time of spawning one task per iteration is extremely slow. </p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> @threads </button>
    <button class="tablink" data-id=""> @spawn </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @threads for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  4.942 ms (123 allocations: 76.306 MiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @sync for i in eachindex&#40;x&#41;
        @spawn output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  9.983 s (60001697 allocations: 5.136 GiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>To have more control over the work distribution, we need to partition objects into smaller subsets that can be processed concurrently. Before explaining the implementation of the technique, we begin showing how to partition a collection and its indices. The procedure relies on the <code>ChunkSplitters</code> package.</p>
 <h4> Partitioning Collections </h4>
<p>The easiest way to partition a collection <code>x</code> and its indices <code>x</code> is through the package <code>ChunkSplitters</code>. The package provides two functions for  <em>lazily</em> partitionining called <code>chunks</code> and <code>index_chunks</code>. The functions accept <code>n</code> and <code>size</code> as keyword arguments, depending on the partition to be implemented. Specifically, <code>n</code> specifies the number of subsets in which the collection should be divided, where each subset&#39;s size attempts to distribute elements evenly. In contrast, <code>size</code> provides the number of elements that each subset should contain. Since <code>size</code> can&#39;t guarantee an even distribution across all subsets, it&#39;ll adjust the number of elements in one of the subsets.</p>
<p>The following example considers a variable <code>x</code> that comprises the 26 letters of the alphabet. Note that the presentation of the outputs uses <code>collect</code>, since <code>chunks</code> and <code>index chunks</code> are lazy. </p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Partition By Number of Chunks </button>
    <button class="tablink" data-id=""> Partition By Size of Chunks </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x             &#61; string.&#40;&#39;a&#39;:&#39;z&#39;&#41;            # all letters from &quot;a&quot; to &quot;z&quot;

nr_chunks     &#61; 5

chunk_indices &#61; index_chunks&#40;x, n &#61; nr_chunks&#41;
chunk_values  &#61; chunks&#40;x, n &#61; nr_chunks&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_indices&#41;</code> <br/> <pre><code class="plaintext code-output">5-element Vector{UnitRange{Int64}}:
 1:6
 7:11
 12:16
 17:21
 22:26</code></pre> </div></p>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_values&#41;</code> <br/> <pre><code class="plaintext code-output">5-element Vector{SubArray{String, 1, Vector{String}, Tuple{UnitRange{Int64}}, true}}:
 ["a", "b", "c", "d", "e", "f"]
 ["g", "h", "i", "j", "k"]
 ["l", "m", "n", "o", "p"]
 ["q", "r", "s", "t", "u"]
 ["v", "w", "x", "y", "z"]</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x             &#61; string.&#40;&#39;a&#39;:&#39;z&#39;&#41;            # all letters from &quot;a&quot; to &quot;z&quot;

chunk_length  &#61; 10

chunk_indices &#61; index_chunks&#40;x, size &#61; chunk_length&#41;
chunk_values  &#61; chunks&#40;x, size &#61; chunk_length&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_indices&#41;</code> <br/> <pre><code class="plaintext code-output">3-element Vector{UnitRange{Int64}}:
 1:10
 11:20
 21:26</code></pre> </div></p>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_values&#41;</code> <br/> <pre><code class="plaintext code-output">3-element Vector{SubArray{String, 1, Vector{String}, Tuple{UnitRange{Int64}}, true}}:
 ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j"]
 ["k", "l", "m", "n", "o", "p", "q", "r", "s", "t"]
 ["u", "v", "w", "x", "y", "z"]</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>One common way to apply partitions for multithreading is by considering a number of chunks that are proportional to the number of worker threads. Moreover, iterations can be based on <code>enumerate</code> to get pairs of chunk index and either the subcollection or subindices.</p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Partition By Number of Threads </button>    
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x             &#61; string.&#40;&#39;a&#39;:&#39;z&#39;&#41;            # all letters from &quot;a&quot; to &quot;z&quot;

nr_chunks     &#61; nthreads&#40;&#41;

chunk_indices &#61; index_chunks&#40;x, n &#61; nr_chunks&#41;
chunk_values  &#61; chunks&#40;x, n &#61; nr_chunks&#41;

chunk_iter    &#61; enumerate&#40;chunk_indices&#41;    # pairs &#40;i_chunk, chunk_index&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_indices&#41;</code> <br/> <pre><code class="plaintext code-output">24-element Vector{UnitRange{Int64}}:
 1:2
 3:4
 ⋮
 25:25
 26:26</code></pre> </div></p>
<div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_iter&#41;</code> <br/> <pre><code class="plaintext code-output">24-element Vector{Tuple{Int64, UnitRange{Int64}}}:
 (1, 1:2)
 (2, 3:4)
 ⋮
 (23, 25:25)
 (24, 26:26)</code></pre> </div>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>collect&#40;chunk_values&#41;</code> <br/> <pre><code class="plaintext code-output">24-element Vector{SubArray{String, 1, Vector{String}, Tuple{UnitRange{Int64}}, true}}:
 ["a", "b"]
 ["c", "d"]
 ⋮
 ["y"]
 ["z"]</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>      </div>
    </div>
  </div>
</section>
<section id="work_distribution_defining_tasks_through_chunks" class="scrollspy">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Work Distribution: Defining Tasks Through Chunks</h2></p>
<p>To define tasks through chunks, we need to partition the collection into smaller subsets that can be processed concurrently. We&#39;ve already discussed how to apply these techniques using the <code>ChunkSplitters</code> package.</p>
<p>Let&#39;s consider a simple example where we want to parallelize a for-loop:</p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> @threads </button>
    <button class="tablink" data-id=""> @spawn </button>
    <button class="tablink" data-id=""> @spawn (equivalent) </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    output &#61; similar&#40;x&#41;
    
    @threads for i in eachindex&#40;x&#41;
        output&#91;i&#93; &#61; log&#40;x&#91;i&#93;&#41;
    end
    
    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  4.942 ms (123 allocations: 76.306 MiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x, nr_chunks&#41;
    chunk_ranges &#61; index_chunks&#40;x, n&#61;nr_chunks&#41;
    output       &#61; similar&#40;x&#41;

    @sync for chunk in chunk_ranges
        @spawn &#40;@views @. output&#91;chunk&#93; &#61; log&#40;x&#91;chunk&#93;&#41;&#41;
    end

    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  5.301 ms (156 allocations: 76.308 MiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x, nr_chunks&#41;
    chunk_ranges &#61; index_chunks&#40;x, n&#61;nr_chunks&#41;
    output       &#61; similar&#40;x&#41;
    task_indices &#61; Vector&#123;Task&#125;&#40;undef, nr_chunks&#41;

    for &#40;i, chunk&#41; in enumerate&#40;chunk_ranges&#41;
        task_indices&#91;i&#93; &#61; @spawn &#40;@views @. output&#91;chunk&#93; &#61; log&#40;x&#91;chunk&#93;&#41;&#41;
    end

    return wait.&#40;task_indices&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  4.893 ms (148 allocations: 76.307 MiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>The approach provides more control over the allocation of tasks to threads. For instance, we could define the number of chunks as proportional to the number of worker threads. </p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> @spawn </button>
    <button class="tablink" data-id=""> @spawn </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x, nr_chunks&#41;
    chunk_ranges &#61; index_chunks&#40;x, n&#61;nr_chunks&#41;
    output       &#61; similar&#40;x&#41;

    @sync for chunk in chunk_ranges
        @spawn &#40;@views @. output&#91;chunk&#93; &#61; log&#40;x&#91;chunk&#93;&#41;&#41;
    end

    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 1 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  4.923 ms (156 allocations: 76.308 MiB)
</code></pre> </div></p>
<div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 2 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  4.898 ms (301 allocations: 76.323 MiB)
</code></pre> </div>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 4 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  4.462 ms (589 allocations: 76.349 MiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function compute&#33;&#40;output, x, chunk&#41;
     @turbo for j in chunk 
        output&#91;j&#93; &#61; log&#40;x&#91;j&#93;&#41;
     end
end

function foo&#40;x, nr_chunks&#41;
    chunk_ranges &#61; index_chunks&#40;x, n&#61;nr_chunks&#41;
    output       &#61; similar&#40;x&#41;

    @sync for chunk in chunk_ranges
        @spawn compute&#33;&#40;output, x, chunk&#41;
    end

    return output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 1 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  4.418 ms (132 allocations: 76.307 MiB)
</code></pre> </div></p>
<div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 2 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  4.546 ms (253 allocations: 76.320 MiB)
</code></pre> </div>
<p><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x, 4 * nthreads&#40;&#41;&#41;</code> <br/> <pre><code class="plaintext code-output">  3.659 ms (493 allocations: 76.344 MiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>      </div>
    </div>
  </div>
</section>
<section id="parallel_reductions" class="scrollspy section-bg-color">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Parallel Reductions</h2></p>
<p>So far, our exploration of parallelization has focused on cases with independent tasks. In particular, the iterations in for-loops were independent, thereby defining an embarrassingly parallel program. This was a deliberate choice, as not all tasks lend themselves to parallelization, due to inherent dependencies between computations. In particular, when tasks aren&#39;t embarrassingly parallel, a naive approach for their computation can not only lead inefficiencies, but actually introduce critical issues, including incorrect results. </p>
<p>Nonetheless, depending on the nature of the dependency, we can adapt our parallelization strategy to still benefit from parallelization. One strategy involves dividing a large task into  <em>smaller independent sub-tasks</em> that can be executed concurrently. By doing so, we can execute the subtasks in parallel without compromising the correctness of the results, as each sub-task remains independent of the others. Once all sub-tasks complete, their results are combined to generate the final output. </p>
<p>The approach is particular suitable for reduction operations. Moreover, its technical implementation is a variant of the partition techniques previously presented. To illustrate it, we consider the simplest scenario possible, where we simply compute the sum of elements of a vector <code>x</code>. </p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Julia's Default (Sequential) </button>
    <button class="tablink" data-id=""> @threads </button>
    <button class="tablink" data-id=""> @spawn </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    output &#61; 0.

    for i in eachindex&#40;x&#41;
        output &#43;&#61; x&#91;i&#93;
    end

    output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  4.909 ms (0 allocations: 0 bytes)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; Vector&#123;Float64&#125;&#40;undef, length&#40;chunk_ranges&#41;&#41;
    
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        partial_outputs&#91;i&#93; &#61; sum&#40;@view&#40;x&#91;chunk&#93;&#41;&#41;
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  1.163 ms (122 allocations: 13.234 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; Vector&#123;Float64&#125;&#40;undef, length&#40;chunk_ranges&#41;&#41;
         
    @sync for &#40;i, chunk&#41; in enumerate&#40;chunk_ranges&#41;
        @spawn partial_outputs&#91;i&#93; &#61; sum&#40;@view&#40;x&#91;chunk&#93;&#41;&#41;
    end
        
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  1.163 ms (155 allocations: 13.750 KiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>      </div>
    </div>
  </div>
</section>
<section id="false_sharing_in_reductions" class="scrollspy">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>False Sharing in Reductions</h2></p>
<p>Cache contention represents a performance challenge where multiple processor cores compete for shared cache resources. A particular manifestation of this issue known as <span style="color: rgb(62, 121, 180);"><strong>False sharing</strong></span> arises when multiple cores access data stored in the same cache line. To understand this issue, it&#39;s essential to grasp how CPU caches function. </p>
<p>Processors use caches to store copies of frequently accessed data. They represent a smaller and faster memory unit than RAM, and are organized into fixed-size blocks called cache lines &#40;typically 64 bytes&#41;. When data is needed, the processor first checks the cache. If the data isn&#39;t found, this must be retrieved from RAM and store a copy in the cache, a process that&#39;s significantly slower. </p>
<p>When multiple cores access data within the same cache line, the transfer of data follows a cache coherency protocol. This designed to maintain data consistency across cores. This protocol can lead to situations where one core accesses data that isn&#39;t modified by another core, yet shares a cache block with altered data. In such cases, the entire cache line may be invalidated, forcing the cores to reload the entire cache block, despite there being no logical necessity to do so. This phenomenon is known as false sharing, and can cause unnecessary cache invalidations and refetches. The consequence is a significant degradation of the program&#39;s performance, particularly if threads frequently modify their variables.</p>
<p>While false sharing can occur in various multithreading scenarios, it&#39;s particularly prevalent in reduction operations. This case will be our focus next.</p>
 <h4> An Illustration and Solutions for Reductions </h4>
<p>Let&#39;s consider a simple scenario where the elements of a vector are summed after applying a logarithmic transformation. We&#39;ll present two multithreaded implementations to illustrate the impact of false sharing on performance.</p>
<p>The first implementation is a naive approach that closely resembles a typical sequential implementation. Its goal is to illustrate false sharing. The issue arises because multiple threads are repeatedly reading and writing adjacent memory locations in the <code>partial_outputs</code> vector. Since CPU cache lines typically span several vector elements, this leads to cache invalidation and forced synchronization between cores.</p>
<p>In contrast, the second implementation avoids false sharing, and we&#39;ll analyze why this is so after presenting the code snippets.</p>
 <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Sequential </button>
    <button class="tablink" data-id=""> False Sharing </button>
    <button class="tablink" data-id=""> Local Variable (@threads) </button>
    <button class="tablink" data-id=""> Local Variable (@spawn) </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    output &#61; 0.

    for i in eachindex&#40;x&#41;
        output &#43;&#61; log&#40;x&#91;i&#93;&#41;
    end

    output
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  33.629 ms (0 allocations: 0 bytes)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; zeros&#40;length&#40;chunk_ranges&#41;&#41;
    
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        for j in chunk
            partial_outputs&#91;i&#93; &#43;&#61; log&#40;x&#91;j&#93;&#41;
        end
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  12.579 ms (122 allocations: 13.234 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; zeros&#40;length&#40;chunk_ranges&#41;&#41;
    
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        temp &#61; 0.0
        for j in chunk
            temp &#43;&#61; log&#40;x&#91;j&#93;&#41;
        end
        partial_outputs&#91;i&#93; &#61; temp
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  3.579 ms (122 allocations: 13.234 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; zeros&#40;length&#40;chunk_ranges&#41;&#41;    
    
    @sync for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        @spawn begin
            temp &#61; 0.0
            for j in chunk
                temp &#43;&#61; log&#40;x&#91;j&#93;&#41;
            end
            partial_outputs&#91;i&#93; &#61; temp
        end
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  3.379 ms (155 allocations: 13.750 KiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>
<p>To address false sharing in parallel reductions, there are several strategies that can be employed. All of them aim to prevent threads from repeatedly accessing the same cache line. </p>
<p>The previous example already presented one solution. It involves introducing a thread-local variable called <code>temp</code> to accumulate results. In this way, each thread maintains its own accumulator, writing to the shared array only once at the end. </p>
<p>Two additional solutions are presented below. The first one entails computing the reduction through a separate function. This address false sharing by the same logic as before, where the accumulation is done through a variable local to a function. The second solution involves defining <code>partial_outputs</code> as a matrix with extra rows &#40;seven in particular&#41;, a technique known as vector padding. This approach guarantees that each thread&#39;s accumulator is allocated on a different cache line, so that that concurrent updates don&#39;t interfere with each other at the cache level.</p>
<p> <div class=" hide_tab"> <details  open><summary  ><div class="closed_text"> </div>  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Function</button>    
    <button class="tablink" data-id=""> Padding </button>    
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function compute&#40;x, chunk&#41;
    temp &#61; 0.0

    for j in chunk
        temp &#43;&#61; log&#40;x&#91;j&#93;&#41;
    end
    
    return temp
end

function foo&#40;x&#41;
    chunk_ranges    &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;
    partial_outputs &#61; zeros&#40;length&#40;chunk_ranges&#41;&#41;    
    
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        partial_outputs&#91;i&#93; &#61; compute&#40;x, chunk&#41;
    end
    
    return sum&#40;partial_outputs&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  3.504 ms (122 allocations: 13.234 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x &#61; rand&#40;10_000_000&#41;

function foo&#40;x&#41;
    chunk_ranges     &#61; index_chunks&#40;x, n&#61;nthreads&#40;&#41;&#41;    
    partial_outputs  &#61; zeros&#40;7, length&#40;chunk_ranges&#41;&#41;    
        
    @threads for &#40;i,chunk&#41; in enumerate&#40;chunk_ranges&#41;
        for j in chunk 
            partial_outputs&#91;1,i&#93; &#43;&#61; log&#40;x&#91;j&#93;&#41;
        end
    end
    
    return sum&#40;@view&#40;partial_outputs&#91;:,1&#93;&#41;&#41;
end</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><div class="julia_line">julia&gt</div> <code>@btime foo&#40;&#36;x&#41;</code> <br/> <pre><code class="plaintext code-output">  3.729 ms (122 allocations: 14.438 KiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div>       </div>
    </div>
  </div>
</section>

<footer class="py-1"> 
  <div class="container"> 
      <span class="left-text">
          <a href="/julia_book/PAGES/11e_multithread_loops" class="prevPage">
              <img src="/julia_book/assets/icons/prev-page.png" style="width:50px; height:auto;opacity:0.9;padding-bottom:5px;">
              Previous Section 
              <span class="ctrl-text">( <kbd>Ctrl + <img src="/julia_book/assets/icons/arrow_left.png" style="width:15px; height:auto;opacity:0.9;padding-bottom:2px;"> </kbd> )</span>
          </a>
      </span> 
      <span class="right-text">
          <a href="/julia_book/PAGES/11g_multithread_packages" class="nextPage">
              Next Section 
              <span class="ctrl-text">( <kbd>Ctrl + <img src="/julia_book/assets/icons/arrow_right.png" style="width:15px; height:auto;opacity:0.9;padding-bottom:2px;"> </kbd> )</span>
              <img src="/julia_book/assets/icons/next-page.png" style="width:50px; height:auto;opacity:0.9;padding-bottom:5px;">
          </a>
      </span> 
      <span class="center-text"> 
          © Martin Alfaro <br>Last Modified August 17, 2025 
      </span> 
  </div> 
</footer>





<style>

@media (max-width: 850px), (max-height: 600px) {
    .ctrl-text {
        display: none;
    }
}


footer{font-family: "Inter";}

footer .container {  
  width          : 100%;
  margin-top     : 0.6em;
  margin-bottom  : 0.5em;
  overflow       : hidden;
  text-align     : center;
  align-items    : center;
  justify-content: center;
  color          : white;
}

footer .center-text {  
  /* float:center;   */
  text-align:center;
  
}

footer .left-text {
  float: left;
  /* text-align: left; */
}

footer .right-text {
  float: right;
  /* text-align: right; */
}

footer a {
  color: white;
}

footer a:hover {
  color: white;
  opacity:0.9;  
  text-decoration: none;
}
/* style="position:relative; display:flex; justify-content:left; align-items: left; text-align:left; color:white; left:0; padding-left:6px;"> */
/* style="position:relative; display:flex; justify-content:right; align-items: right; text-align:right;  color:white; right:0; padding-right:6px;">  */
</style>

<script>
  // Get page URLs
const prevPageURL = document.querySelector(".prevPage").href;
const nextPageURL = document.querySelector(".nextPage").href;

// Add click and keyboard event listeners
document.querySelector(".prevPage").addEventListener("click", goToPrevPage);
document.querySelector(".nextPage").addEventListener("click", goToNextPage);
document.addEventListener("keyup", (e) => {
  if (e.key === "ArrowLeft" && e.ctrlKey) {
    goToPrevPage();
  } else if (e.key === "ArrowRight" && e.ctrlKey) {
    goToNextPage();
  }
});

// Click handler functions 
function goToPrevPage() {
  window.location = prevPageURL; 
}
function goToNextPage() {
  window.location = nextPageURL; 
}


</script>
</div><!-- CONTENT ENDS HERE -->

<!-- ADDED BY FRANKLIN -->
  
      <script src="/julia_book/libs/katex/katex.min.js"></script>
<script src="/julia_book/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

  
  
      <script src="/julia_book/libs/highlight/highlight.js"></script>
<!-- <script src="/julia_book/libs/highlight/julia.highlight.js"></script> -->
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>
<!-- <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script> -->


  
  <script src="/julia_book/libs/simple-scrollspy.min.js"></script>
  <script>
  window.onload = function () {
    scrollSpy('#navbarResponsive', {
      sectionClass: '.scrollspy',
      menuActiveTarget: '.nav-link',
      offset: 100
    })
  }
  </script>
  </body>
</html>



<!-- 
#################################################
# FOR ALL PAGES
################################################# 
-->

<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script> 
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script> -->



<!-- FOR ICONS -->
<!-- <script async defer src="https://buttons.github.io/buttons.js"></script> -->




<!-- FOR MODALS and TABS-->
<script>

  const btns   = document.getElementsByClassName('modalButton');
  const modals = document.getElementsByClassName('modal');

  [...btns].forEach((btn, ind) => {
    btn.onclick = () => {
      if (modals[ind].style.display === 'block') {
        modals[ind].style.display = 'none';
      } else {
        modals[ind].style.display = 'block';
      }
    };
  });


  // Close the modal when user clicks outside of it
  window.addEventListener('click', function (event) {
    const modals        = document.getElementsByClassName('modal');
    const modalContents = document.getElementsByClassName('modal-content');
    const modalButtons  = document.getElementsByClassName('modalButton');
    for (let i = 0; i < modals.length; i++) {
      const modal        = modals[i];
      const modalContent = modalContents[i];
      const modalButton  = modalButtons[i];
      if (modal.style.display === 'block' && !modalContent.contains(event.target) && !modalButton.contains(event.target)) {
        modal.style.display = 'none';
      }
    }
  });


  document.addEventListener('keydown', function (event) {
    if (event.ctrlKey && event.key === 'z') {
      // Select the button element      
      const modal = document.getElementById('modal_bar');
      if (modal && modal.style.display === 'block') {
        modal.style.display = 'none';
      }
      else { modal.style.display = 'block'; }

      // Check if modal with id="modal_bar" is opened
    }
  });



</script>

<!-- NECESSARY TO MAKE IT WORK -->
<script> 
let handleClick = e => {
  Array.from(e.target.parentElement.parentElement.querySelectorAll(".active"), e => e.classList.remove("active")); // remove `active` class from every elements which contains him.
  e.target.classList.add("active");
  document.querySelector(`div.tabcontent[data-id*="${e.target.dataset.id}"]`).classList.add("active");
 
};

Array.from(document.getElementsByClassName("tablink"), btn => btn.addEventListener('click', handleClick, false));
</script>





<!-- FOR SETTING SAME HEIGHT of CODE and OUTPUT WITHIN A TABCONTENT -->
<script>
  let setHeight = () => {
  let tabWrappers = document.querySelectorAll('.tab_wrapper');
  tabWrappers.forEach(wrapper => {
    let tabContents = wrapper.querySelectorAll('.tabcontent');
    let maxCodeHeight = 0;
    let maxOutputHeight = 0;

    tabContents.forEach(tabContent => {
      // Temporarily show the tabContent to calculate its children's height
      let originalVisibility = tabContent.style.visibility;
      tabContent.style.visibility = 'visible';

      let originalPosition = tabContent.style.position;
      let originalDisplay = tabContent.style.display;
      tabContent.style.position = 'relative';
      tabContent.style.display = 'inline-block';

      let codeInModal = tabContent.querySelector('.code_in_modal');
      let outputInModal = tabContent.querySelector('.output_in_modal');

      if (codeInModal) {
        codeInModal.style.height = 'auto';
        let codeHeight = codeInModal.offsetHeight;
        if (codeHeight > maxCodeHeight) {
          maxCodeHeight = codeHeight;
        }
      }

      if (outputInModal) {
        outputInModal.style.height = 'auto';
        let outputHeight = outputInModal.offsetHeight;
        if (outputHeight > maxOutputHeight) {
          maxOutputHeight = outputHeight;
        }
      }

      // Restore the original position and visibility
      tabContent.style.visibility = originalVisibility;
      tabContent.style.position = originalPosition;
      tabContent.style.display = originalDisplay;
    });

    tabContents.forEach(tabContent => {
      let codeInModal = tabContent.querySelector('.code_in_modal');
      let outputInModal = tabContent.querySelector('.output_in_modal');

      if (codeInModal) {
        codeInModal.style.height = maxCodeHeight + 'px';
      }

      if (outputInModal) {
        outputInModal.style.height = maxOutputHeight + 'px';
      }
    });
  });
};

window.addEventListener('load', setHeight);
window.addEventListener('resize', setHeight);
</script>








<!-- <script> 
   OLD FOR SETTING HEIGHT OF TABCONTENT ONLY
    let setHeight = () => {
      let tabWrappers = document.querySelectorAll('.tab_wrapper');
      tabWrappers.forEach(wrapper => {
        let tabs = wrapper.querySelectorAll('.tabcontent');
        let maxHeight = 0;
        tabs.forEach(tab => {
          // Temporarily show the tab to calculate its height
          let originalVisibility = tab.style.visibility;
          tab.style.visibility = 'visible';

          let originalPosition = tab.style.position;
          let originalDisplay = tab.style.display;
          tab.style.position = 'relative';
          tab.style.display = 'inline-block';

          tab.style.height = '100%';
          let height = tab.offsetHeight;
          if (height > maxHeight) {
            maxHeight = height;
          }

          // Restore the original position and visibility
          tab.style.visibility = originalVisibility;
          tab.style.position = originalPosition;
          tab.style.display = originalDisplay;
        });
        tabs.forEach(tab => {
          tab.style.height = maxHeight + 'px';
        });
      });
    };

  window.addEventListener('load', setHeight);
  window.addEventListener('resize', setHeight);
</script> -->


<script>
  // Get all the tab wrappers on the page
  var tabWrappers = document.getElementsByClassName("tab_wrapper");

  // Iterate over the tab wrappers
  for (var i = 0; i < tabWrappers.length; i++) {
    var tabWrapper = tabWrappers[i];
    var buttons = tabWrapper.getElementsByClassName("tablink");
    var tabContents = tabWrapper.getElementsByClassName("tabcontent");

    // Set the data-id values for each button and tab content
    for (var j = 0; j < buttons.length; j++) {
      var button = buttons[j];
      var tabContent = tabContents[j];
      var dataId = "tab" + (i + 1) + "_" + (j + 1); // Create the data-id value

      // Set the data-id attribute for the button
      button.setAttribute("data-id", dataId);

      // Set the data-id attribute for the tab content
      tabContent.setAttribute("data-id", dataId);
    }
  }
</script>

<!-- to close all the elements in a class "details" using "Alt" + "Up Arrow" -->
<script>
document.addEventListener("keydown", function(event) {
  if (event.code === "ArrowUp" && event.altKey) {    
    var details = document.getElementsByTagName("details");
    for (var i = 0; i < details.length; i++) {
        details[i].open = false;
    }
  }
});
</script>



<!-- to open all the elements in a class "details" using "Alt" + "Down Arrow" -->
<script>
    document.addEventListener("keydown", function(event) {
  if (event.code === "ArrowDown" && event.altKey) {
    var details = document.getElementsByTagName("details");
    for (var i = 0; i < details.length; i++) {
        details[i].open = true;
    }
  }
});



// // USER- TO USE ESCAPE TO CLOSE IT
window.onkeydown = function(event) {
        if (event.key == 'Escape') {
            for(let modal of modals) {
                modal.style.display = 'none';
            }
        }
    }
</script>
  





<!-- FOR PICS -->
<style>

/* for collapsible pics  */
.pic_drop_green{    
  padding-top   : 1em;
  padding-bottom: 1em ;
  }

.pic_drop_green details > summary {  
  color       : white;
  display     : inline-block;
  width       : auto;
  cursor      : pointer;

  padding     : 0px 6px;
  margin      : 0;

  border-width: 1px;
  border-style: solid;
  box-shadow  : 3px 3px 4px black;

    /* list-style: none;   */
  background-color: #3f6b4b;
}


.pic_drop_green details[open] > summary {
  width           : auto;
  padding         : 0px 6px;
  
  border          : #a8a8a8;
  border-width    : 1px;
  border-style    : solid;
  
  color           : white;
  background-color: #3f6b4b;
  
  
}

.pic_drop_green details > p {
  display: block;
  width  : auto;
  padding: 0;
  margin : 0;
}





/* ===================
for multiple pics in a row 
==================== */

.multiple_pics{text-align: center;}

.multiple_pics h2{text-decoration:none; padding-bottom:0;}

.multiple_pics .row {
  display: flex;
}

.multiple_pics .column2 {  flex: 50%;}

.multiple_pics .column3 {  flex: 33.33%;}
  
/* 
\html{
<div class="multiple_pics">
<div class="row">
  <div class="column2">
  <h2>CORRECT Interpretation</h2>
    <img src="/julia_book/assets/tikz/3d_mutation/interpret01a.svg" style="width:400px ; height:auto; padding-right:0em;">
  </div>
  <div class="column2">
  <h2>INCORRECT Interpretation</h2>
    <img src="/julia_book/assets/tikz/3d_mutation/interpret01b.svg" style="width:435px ; height:auto">
  </div>  
</div>
</div>
}
 */

</style>

<!-- FOR COPYING THE TITLES IN SECTION -->
       
  
<script>
    function generateId(text) {
        return text.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '_');
    }

    function copyToClipboard(url) {
        const tempInput = document.createElement('input');
        document.body.appendChild(tempInput);
        tempInput.value = url;
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
    }

    function showTooltip(event, parentElement, message = 'Link Copied') {
        const tooltipContainer = document.createElement('div');
        tooltipContainer.style.position = 'absolute';

        const tooltip                    = document.createElement('span');
              tooltip.textContent        = message;
              tooltip.style.position     = 'absolute';
              tooltip.style.background   = 'rgba(63, 99, 136, 0.75)';
              tooltip.style.color        = 'white';
              tooltip.style.padding      = '4px 2px';
              tooltip.style.borderRadius = '4px';
              tooltip.style.fontSize     = '14px';
              tooltip.style.textAlign    = 'center';
              tooltip.style.fontWeight   = '700';

        tooltipContainer.appendChild(tooltip);
        parentElement.appendChild(tooltipContainer);

        const rect = parentElement.getBoundingClientRect();
        const x = event.clientX - rect.left - 28;
        const y = event.clientY - rect.bottom - 25;

        tooltip.style.top = `${y}px`;
        tooltip.style.left = `${x}px`;

        setTimeout(() => {
            parentElement.removeChild(tooltipContainer);
        }, 1000);
    }

    function handleH2Elements() {
        const h2Elements = document.querySelectorAll('h2');

        h2Elements.forEach(h2 => {
            h2.addEventListener('click', function (event) {
                const text = h2.textContent.trim();
                const url = `${window.location.origin}${window.location.pathname}#${generateId(text)}`;

                copyToClipboard(url);
                showTooltip(event, h2);
            });
        });
    }

    function handleH4Elements() {
        const h4Elements = document.querySelectorAll('h4');

        h4Elements.forEach(h4 => {
            const text = h4.textContent.trim();
            const id   = `sub_${generateId(text)}`;
            h4.setAttribute('id', id);

            const linkElement                      = document.createElement('a');
                  linkElement.href                 = `#${id}`;
                  linkElement.innerHTML            = h4.innerHTML;
                  linkElement.style.textDecoration = 'underline';

            h4.innerHTML = '';
            h4.appendChild(linkElement);

            linkElement.addEventListener('click', function (event) {
                const url = linkElement.href;

                copyToClipboard(url);
                showTooltip(event, h4);

                event.preventDefault();
            });
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        handleH2Elements();
        handleH4Elements();
    });
</script>

<style>
    h2,h4 {
        cursor: pointer;
    }

    .hand-cursor {
        cursor: wait;
    }

    h4:hover, h2:hover {
        color: rgba(0,0,0, 0.5);
    }
</style>



    




<!-- 
#################################################
# FOR EACH SPECIFIC PAGE
#################################################
 -->


<!-- FOR NAVIGATION-->
       
  
<!-- to make it visible as default change line 9 by
<div class="collapse show navbar-collapse" id="collapsibleNavbar"> -->


  <nav class="nav">
    <button class="nav-toggle" aria-label="Toggle navigation">
      <!-- <span class="nav-toggle-icon"></span> -->
        <img src="/julia_book/assets/icons/dropdown.png" style="width:auto; height:30px; opacity:0.9; padding-bottom:2px;margin-left:0px;">
      <span class="nav-title"><i>11f.</i> Applying Parallelization</span>
    </button>
    <div class="nav-menu">
      <ul>
        
        <li>
          <a href="#introduction" data-offset="-40">Introduction</a>
        </li>
        
        <li>
          <a href="#better_to_parallelize_at_the_top" data-offset="-40">Better To Parallelize at The Top</a>
        </li>
        
        <li>
          <a href="#the_importance_of_work_distribution" data-offset="-40">The Importance of Work Distribution</a>
        </li>
        
        <li>
          <a href="#work_distribution_defining_tasks_through_chunks" data-offset="-40">Work Distribution: Defining Tasks Through Chunks</a>
        </li>
        
        <li>
          <a href="#parallel_reductions" data-offset="-40">Parallel Reductions</a>
        </li>
        
        <li>
          <a href="#false_sharing_in_reductions" data-offset="-40">False Sharing in Reductions</a>
        </li>
        
      </ul>
    </div>
  </nav>
  
 



<script>
const navToggle = document.querySelector('.nav-toggle');
const navMenu   = document.querySelector('.nav-menu');
const navLinks  = document.querySelectorAll('.nav-menu a');

navToggle.addEventListener('click', () => {
  navMenu.classList.toggle('show');
});

navLinks.forEach((link) => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    const target = document.querySelector(link.getAttribute('href'));
    const offset = parseInt(link.dataset.offset, 10) || 0;
    window.scrollTo({ top: target.offsetTop + offset, behavior: 'smooth' });
  });
});

document.addEventListener('click', (e) => {
  if (!navMenu.contains(e.target) && !navToggle.contains(e.target)) {
    navMenu.classList.remove('show');
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    navMenu.classList.remove('show');
  }
  if (e.key === 'x' && e.ctrlKey) {
    navMenu.classList.toggle('show');
  }
});

</script>


<style>
  /* ================================================================= 
                      NAVIGATION BAR
================================================================= */ 
.nav {
  position        : fixed;
  top             : 0;
  right           : 0;
  z-index         : 200;
  background-color: rgb(63,99,136);
  padding         : 0;
  display         : block;
  font-family     : "Inter";
}

.nav-toggle {
  background-color: rgb(63, 99, 136);
  border          : none;
  padding         : 8px;
  padding-right   : 24px;
  font-size       : 18px;
  cursor          : pointer;
}

/* .nav-toggle-icon {
  display: inline-block;
  width: 20px;
  height: 20px;
  background-image: url('/assets/icons/sheets02.png');
  background-size: 28px 20px;
} */

.nav-menu {
  position        : fixed;
  right           : 0;
  top             : 48px;
  background-color: rgb(63,99,136);
  padding         : 10px;
  width           : 300px;
  height          : 100vh;
  overflow-y      : auto;
  display         : none;
}

.nav-menu ul {
  list-style: none;
  margin    : 0;
  padding   : 0;
}

.nav-menu li {
  margin-bottom: 10px;
}

.nav-menu a {
  color          : #fff;
  text-decoration: none;
  font-size      : 18px;
  font-weight    : bold;
  text-align     : center;
  padding        : 10px 10px;
  display        : block;
}

.nav-menu a:hover {
  color           : white;
  background-color: black;
}

.nav-title {
  font-size  : 18px;
  margin-left: 10px;
  color      : #fff;
}

.nav-brand {
  font-size  : 24px;
  font-weight: bold;
  margin     : 10px 20px;
  color      : #fff;
}

.nav-menu.show {
  display: block;
}





</style>    




  
<!-- COPY BUTTON -->
<script src="/julia_book/libs/clipboard.min.js"></script> 
<!-- http://tutsplus.github.io/clipboard/ -->

<script>
    (function(){
    
        // Get the elements.
        // - the 'pre' element.
        // - the 'div' with the 'paste-content' id.
    
        var pre = document.getElementsByTagName('pre');
    
        // Add a copy button in the 'pre' element.
        // which only has the className of 'language-' or ' hljs'(if enable highlight.js pre-render).
    
        for (var i = 0; i < pre.length; i++) {
            var tag_name = pre[i].children[0].className
                    var isLanguage = tag_name.startsWith('language-') || tag_name.endsWith(' hljs');
            if ( isLanguage ) {
                var button           = document.createElement('button');
                        button.className = 'copy-button';
                        button.textContent = 'Copy';
    
                        pre[i].appendChild(button);
            }
        };
    
        // Run Clipboard
    
        var copyCode = new Clipboard('.copy-button', {
            target: function(trigger) {
                return trigger.previousElementSibling;
        }
        });
    
        // On success:
        // - Change the "Copy" text to "Copied".
        // - Swap it to "Copy" in 2s.
        // - Lead user to the "contenteditable" area with Velocity scroll.
    
        copyCode.on('success', function(event) {
            event.clearSelection();
            event.trigger.textContent = 'copied!';
            window.setTimeout(function() {
                event.trigger.textContent = 'copy';
            }, 2000);
    
        });
    
        // On error (Safari):
        // - Change the  "Press Ctrl+C to copy"
        // - Swap it to "Copy" in 2s.
    
        copyCode.on('error', function(event) {
            event.trigger.textContent = 'Press "Ctrl + C" to copy';
            window.setTimeout(function() {
                event.trigger.textContent = 'Copy';
            }, 5000);
        });
    
    })();
    </script>




<!-- FOR PDF -->

  <style>
  
@media print {
      .franklin-content{    
    box-sizing : border-box;}    

    .jumbotron {
        padding-right: 60px !important;
    }

    .jumbotron, .name_format, .phd_format{
        color: black !important;
    }



    .name_format a { color: rgb(63,99,136); }

          
    
          
    nav, .tab_code_links, .hide_tab > details[open] > summary, .hide_tab details[open] p, .sign_output{
        display: none !important;        }
    
    .footn, footer, .left_bar_mobile, .left_bar, .bar_top, nav, .navbar, .nav-item, .copy-button, .bar_top .modalButton  {
          display: none !important;        }
  
    
    .tab_wrapper {
      display       : flex !important;
      flex-wrap     : wrap;
      gap           : 1cm;
      width         : 100%;
      padding-top   : 20px;
      padding-bottom: 20px;
    }
  
  
    .tabcontent {
      display          : block !important;
      margin-bottom    : 2em;
      page-break-inside: avoid;
      border           : 2px solid rgb(63,99,136) !important;
      /* border           : 2px solid black !important; */
    }
  
  
  
    .print-tab-title {
      font-weight : bold;
      font-size   : 100%;
      padding     : 0 0;
      padding-left: 0.35cm;
        /* border-bottom : 2px solid rgb(63,99,136);       */
      color         : #000;
      text-transform: uppercase;
      display       : block !important;
    }
  
    .code_in_modal, .output_in_modal {
      width   : 100%;
      height  : auto !important;  /* Ensure content expands naturally */
      overflow: visible;
      border  : none !important;
    }

    .code_NoFormat pre, .mixed_output_NoFormat pre{
        border: none !important;}

    

    .code_in_modal, .code_NoFormat, .mixed_output_NoFormat, .mixed_output_inline, .julia_repl_NoFormat{
        margin : 0em !important;
        padding: 0em !important;
    }

    .code_NoFormat, .mixed_output_NoFormat, .julia_repl_NoFormat{
      padding-left: 0.35cm !important;
      padding-top:  0.15cm !important;
    }



    .output_in_modal{
        margin-top: 12px !important;
        border-top: 2px solid #20c679 !important;
    }

  .code_NoFormat, .code_in_modal{
      border-top: 2px solid rgb(63,99,136);
    }

    #remarkCodeContent {
      height    : 0.1px !important;
      visibility: hidden !important;
    }

  }
  </style>
  
  <script>

function printAllTabs() {
    const tabButtons  = document.querySelectorAll('.tablink');
    const tabContents = document.querySelectorAll('.tabcontent');
    
        // First pass: Add titles
    tabContents.forEach((tab, index) => {
      const title = tabButtons[index].textContent.trim();
      if (!tab.querySelector('.print-tab-title')) {
        const titleDiv             = document.createElement('div');
              titleDiv.className   = 'print-tab-title';
              titleDiv.textContent = title;
        tab.insertBefore(titleDiv, tab.firstChild);
      }
    });
    
    var links = document.getElementsByTagName('a');
    for (var i = 0; i < links.length; i++) {
        links[i].removeAttribute('href');
        links[i].style.textDecoration = 'none';
}


}

    // Run the function only when printing
window.matchMedia('print').addListener((mql) => {
  if (mql.matches) {
    printAllTabs();
  } else {
        // Remove the added titles when not printing
    const tabContents = document.querySelectorAll('.tabcontent');
    tabContents.forEach((tab) => {
      const titleDiv = tab.querySelector('.print-tab-title');
      if (titleDiv) {
        tab.removeChild(titleDiv);
      }
    });
  }
});

  </script>

















<!-- <script>

  $('a[href*="#"]').on('click', function (event) {
    event.preventDefault();
    var target = $(this.hash);
    var offset = 500; // adjust this value to fit your needs
    $('html, body').animate({
      scrollTop: target.offset().top - offset
    }, 500);
  });

</script> -->

